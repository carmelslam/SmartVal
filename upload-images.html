<!DOCTYPE html>

<html dir="rtl" lang="he">
<head>
<meta charset="utf-8"/>
<script type="module" src="./webhook.js"></script>
<title>העלאת תמונות</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    body { font-family: sans-serif; background: #f0f4ff; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .container { max-width: 400px; background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; }
    .logo { width: 100px; margin-bottom: 20px; }
    h2 { font-size: 20px; margin-bottom: 20px; }
    input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ccc; }
    .btn { width: 100%; padding: 12px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
    .footer-btns { display: flex; justify-content: space-between; margin-top: 20px; }
    .footer-btns button { width: 48%; padding: 10px; font-size: 14px; border-radius: 8px; border: none; cursor: pointer; }
    .home-btn { background-color: #6c757d; color: white; }
    .logout-btn { background-color: #dc3545; color: white; }
    .footer { font-size: 12px; color: #aaa; margin-top: 15px; }
  </style>
<link rel="icon" type="image/webp" href="https://carmelcayouf.com/wp-content/uploads/2025/06/g.webp" />
<link rel="shortcut icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp" />
<link rel="apple-touch-icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp" />
</head>
<body>
<div class="container">
<img class="logo" src="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp"/>
<h2>העלאת תמונות - ירון כיוף</h2>
<form id="form" method="POST" onsubmit="return false;">
<input id="plate" name="plate" placeholder="הזן מס רכב" required="" type="text"/>
<input id="owner" name="owner" placeholder="הזן שם בעל הרכב" required="" type="text"/>
<input id="images" accept="image/*" multiple="" name="images" required="" type="file"/><input name="pass" placeholder="סיסמא" required="" type="password"/>
<button class="btn" type="submit">שלח תמונות</button>
<div id="preview-container" style="margin-top:10px; padding:10px; border:1px solid #ccc; display:flex; flex-wrap:wrap; gap:10px; max-height:200px; overflow:auto;"></div>
<div class="toggle-link" onclick="toggleMoreOptions()" style="color:#007BFF;cursor:pointer;margin:10px 0;">אפשרויות נוספות ⬇️</div>
<div id="more-options" style="display:none;margin-bottom:15px;">
  <button class="btn" type="button" onclick="sendExtraWebhook('TRANSFORM_PICTURES')">📸 בצע עיבוד תמונות</button>
  <button class="btn" type="button" onclick="sendExtraWebhook('CREATE_PDF')">📄 צור PDF מהתמונות</button>
</div>
</form>
<div class="footer-btns">
<button class="home-btn" onclick="window.location.href='selection.html'">לעמוד הבית</button>
<button class="logout-btn">יציאה מהמערכת</button>
</div>
<div class="footer">All rights reserved © Carmel Cayouf</div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const savedPass = sessionStorage.getItem("ycPass");
        const passInput = document.querySelector("input[type='password']");
        if (savedPass && passInput) {
            passInput.value = savedPass;
        }
    });
    </script>

   <script>
document.addEventListener("DOMContentLoaded", function () {
  const logoutBtn = document.querySelector(".logout-btn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", function (e) {
      e.preventDefault();
      sessionStorage.clear();
      window.location.href = "index.html";
    });
  }
});
</script><script>
document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.querySelector("input[type='file']");
    const form = document.querySelector("form");
    const previewContainer = document.getElementById("preview-container");

    if (!previewContainer) return;

    previewContainer.style.minHeight = "80px";
    previewContainer.style.border = "1px dashed #aaa";
    previewContainer.style.padding = "10px";
    previewContainer.style.marginTop = "10px";
    previewContainer.style.display = "flex";
    previewContainer.style.flexWrap = "wrap";
    previewContainer.style.gap = "10px";

    let allFiles = [];

    fileInput.setAttribute("accept", "image/*");
    fileInput.removeAttribute("capture");

    fileInput.addEventListener("change", function () {
        allFiles = [...allFiles, ...Array.from(fileInput.files)];
        const dataTransfer = new DataTransfer();
        allFiles.forEach(f => dataTransfer.items.add(f));
        fileInput.files = dataTransfer.files;
        renderPreviews();
    });

    function renderPreviews() {
        previewContainer.innerHTML = "";

        allFiles.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const wrapper = document.createElement("div");
                wrapper.style.position = "relative";

                const img = document.createElement("img");
                img.src = e.target.result;
                img.style.width = "60px";
                img.style.height = "60px";
                img.style.objectFit = "cover";
                img.style.border = "1px solid #ccc";
                img.style.borderRadius = "4px";

                const delBtn = document.createElement("button");
                delBtn.textContent = "✕";
                delBtn.style.position = "absolute";
                delBtn.style.top = "0";
                delBtn.style.right = "0";
                delBtn.style.background = "rgba(255,0,0,0.7)";
                delBtn.style.color = "white";
                delBtn.style.border = "none";
                delBtn.style.borderRadius = "50%";
                delBtn.style.cursor = "pointer";
                delBtn.onclick = function () {
                    allFiles.splice(index, 1);
                    const dt = new DataTransfer();
                    allFiles.forEach(f => dt.items.add(f));
                    fileInput.files = dt.files;
                    renderPreviews();
                };

                wrapper.appendChild(img);
                wrapper.appendChild(delBtn);
                previewContainer.appendChild(wrapper);
            };
            reader.readAsDataURL(file);
        });
    }
});
</script>
 <script type="module">
    import { getWebhook } from './webhook.js';

    // FIX: Use correct form id
    document.getElementById("form").addEventListener("submit", async function(e) {
      e.preventDefault();
      const plate = document.getElementById("plate").value;
      const files = document.getElementById("images").files;
      const formData = new FormData();
      formData.append("plate", plate);
      for (const file of files) {
        formData.append("images[]", file);
      }
      const res = await fetch(getWebhook("UPLOAD_PICTURES"), { method: "POST", body: formData });
      alert(res.ok ? "✅ התמונות נשלחו בהצלחה" : "❌ שגיאה בשליחת התמונות");
    });

    window.sendToWebhook = function(type) {
      const plate = document.getElementById("plate").value;
      const formData = new FormData();
      formData.append("plate", plate);
      const webhook = type === 'transform' ? getWebhook("TRANSFORM_PICTURES") : getWebhook("CREATE_PDF");
      fetch(webhook, { method: "POST", body: formData })
        .then(res => alert(res.ok ? `✅ פעולה '${type}' הושלמה` : `❌ שגיאה בביצוע '${type}'`));
    }

   
  </script>
<script>
  window.toggleMoreOptions = function () {
    const box = document.getElementById("more-options");
    if (box) {
      box.style.display = box.style.display === "none" ? "block" : "none";
    }
  };
</script>




</body>
</html>
