# PiP Results Display Flow - Visual Diagrams

## Flow 1: Catalog Search Results

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Click "×—×¤×© ×‘×§×˜×œ×•×’"                                 â”‚
â”‚ parts search.html: searchSupabase()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEARCH EXECUTION                                                 â”‚
â”‚ â€¢ SmartPartsSearchService.searchParts(searchParams)             â”‚
â”‚ â€¢ Query Supabase catalog_items table                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTS FROM DATABASE (Each Row Contains):                      â”‚
â”‚ â€¢ make: "×˜×•×™×•×˜×”"                    â† From DB                  â”‚
â”‚ â€¢ model: "×§×•×¨×•×œ×”"                   â† From DB                  â”‚
â”‚ â€¢ year_from: 2015, year_to: 2020    â† From DB                  â”‚
â”‚ â€¢ pcode: "12345-AB"                  â† From DB                  â”‚
â”‚ â€¢ cat_num_desc: "×‘×•×œ× ×§×“××™ ×™××™×Ÿ"   â† From DB                  â”‚
â”‚ â€¢ supplier_name: "×¡×¤×§ ×'"           â† From DB                  â”‚
â”‚ â€¢ part_family: "××ª×œ×™×"              â† From DB                  â”‚
â”‚ â€¢ price: 450                         â† From DB                  â”‚
â”‚ â€¢ availability: "××§×•×¨×™"             â† From DB                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PREPARE PIP CONTEXT                                              â”‚
â”‚ pipContext = {                                                   â”‚
â”‚   plate: "1234567",                                             â”‚
â”‚   dataSource: 'catalog',  â† Triggers GREEN BADGE ğŸ—„ï¸            â”‚
â”‚   searchParams: { manufacturer, model, year, ... }              â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DISPLAY IN PIP                                                   â”‚
â”‚ window.partsResultsPiP.showResults(results, pipContext)         â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ×ª×•×¦××•×ª ×—×™×¤×•×© ×—×œ×§×™× ğŸ—„ï¸ ×§×˜×œ×•×’ (GREEN)                       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ × ××¦××• 5 ×ª×•×¦××•×ª â€¢ ×¨×›×‘: 1234567                              â”‚ â”‚
â”‚ â”‚ ×™×¦×¨×Ÿ: ×˜×•×™×•×˜×” â€¢ ×“×’×: ×§×•×¨×•×œ×” â€¢ ×©× ×™×: 2015-2020              â”‚ â”‚
â”‚ â”‚       â†‘ FROM firstResult.make                                â”‚ â”‚
â”‚ â”‚                â†‘ FROM firstResult.model                      â”‚ â”‚
â”‚ â”‚                        â†‘ FROM firstResult.year_from/year_to â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Table Displays:                                              â”‚ â”‚
â”‚ â”‚ â€¢ ×¡×¤×§: FROM result.supplier_name                            â”‚ â”‚
â”‚ â”‚ â€¢ ××¡×¤×¨ ×§×˜×œ×•×’×™: FROM result.pcode                           â”‚ â”‚
â”‚ â”‚ â€¢ ×ª×™××•×¨: FROM result.cat_num_desc                          â”‚ â”‚
â”‚ â”‚ â€¢ ××©×¤×—×ª ×—×œ×§: FROM result.part_family                       â”‚ â”‚
â”‚ â”‚ â€¢ ××—×™×¨: FROM result.price                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flow 2: Web Search Results

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Click "×—×¤×© ×‘××™× ×˜×¨× ×˜"                              â”‚
â”‚ parts search.html: Sends request to Make.com webhook           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEBHOOK EXECUTION                                                â”‚
â”‚ â€¢ Make.com scrapes web sources                                  â”‚
â”‚ â€¢ Returns JSON with Hebrew field names                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEBHOOK RESPONSE (Raw Data):                                    â”‚
â”‚ {                                                               â”‚
â”‚   "×§×•×“_×§×˜×œ×•×’×™": "12345-AB",        â† Supplier part code       â”‚
â”‚   "×ª×™××•×¨_×—×œ×§": "×‘×•×œ× ×§×“××™ ×™××™×Ÿ",   â† Description             â”‚
â”‚   "×©×_×¡×¤×§": "×¡×¤×§ ×‘'",              â† Supplier name            â”‚
â”‚   "××—×™×¨": "420",                     â† Price                    â”‚
â”‚   "×¡×•×’_××§×•×¨": "×ª×—×œ×™×¤×™",            â† Source type              â”‚
â”‚   "××™×§×•×": "×ª×œ ××‘×™×‘",               â† Location                 â”‚
â”‚   NO "make" field âŒ                                            â”‚
â”‚   NO "year_from" field âŒ                                       â”‚
â”‚   NO "year_to" field âŒ                                         â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRANSFORM TO CATALOG FORMAT (lines 1494-1553)                   â”‚
â”‚ transformedResults = {                                          â”‚
â”‚   pcode: item.×§×•×“_×§×˜×œ×•×’×™ || item.catalog_code,                â”‚
â”‚   cat_num_desc: item.×ª×™××•×¨_×—×œ×§ || item.part_description,      â”‚
â”‚   supplier_name: item.×©×_×¡×¤×§ || item.supplier_name,           â”‚
â”‚   price: parseFloat(item.××—×™×¨ || item.price),                 â”‚
â”‚   availability: item.×¡×•×’_××§×•×¨ || '××§×•×¨×™',                     â”‚
â”‚                                                                 â”‚
â”‚   // Filled from USER INPUT (searchParams), NOT webhook:      â”‚
â”‚   model: searchParams.model || '×œ× ××•×’×“×¨',  â† User typed this â”‚
â”‚   part_family: searchParams.part_group,      â† User selected   â”‚
â”‚   extracted_year: searchParams.year,         â† User typed this â”‚
â”‚                                                                 â”‚
â”‚   // MISSING - no source available:                            â”‚
â”‚   make: undefined âŒ  (webhook doesn't have it)                â”‚
â”‚   year_from: undefined âŒ  (webhook doesn't have it)           â”‚
â”‚   year_to: undefined âŒ  (webhook doesn't have it)             â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PREPARE PIP CONTEXT                                              â”‚
â”‚ pipContext = {                                                   â”‚
â”‚   plate: "1234567",                                             â”‚
â”‚   dataSource: 'web',  â† Triggers BLUE BADGE ğŸŒ                 â”‚
â”‚   searchType: 'web_search',                                     â”‚
â”‚   searchParams: { model, year, part_group, ... }                â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DISPLAY IN PIP                                                   â”‚
â”‚ window.partsResultsPiP.showResults(transformedResults, context) â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ×ª×•×¦××•×ª ×—×™×¤×•×© ×—×œ×§×™× ğŸŒ ××™× ×˜×¨× ×˜ (BLUE)                      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ × ××¦××• 3 ×ª×•×¦××•×ª â€¢ ×¨×›×‘: 1234567                              â”‚ â”‚
â”‚ â”‚ (NO vehicle-info subtitle shown)                            â”‚ â”‚
â”‚ â”‚     â†‘ Subtitle hidden because firstResult.make is undefined â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Table Displays:                                              â”‚ â”‚
â”‚ â”‚ â€¢ ×¡×¤×§: FROM webhook.×©×_×¡×¤×§                                 â”‚ â”‚
â”‚ â”‚ â€¢ ××¡×¤×¨ ×§×˜×œ×•×’×™: FROM webhook.×§×•×“_×§×˜×œ×•×’×™                    â”‚ â”‚
â”‚ â”‚ â€¢ ×ª×™××•×¨: FROM webhook.×ª×™××•×¨_×—×œ×§                           â”‚ â”‚
â”‚ â”‚ â€¢ ××©×¤×—×ª ×—×œ×§: FROM searchParams.part_group (user input!)    â”‚ â”‚
â”‚ â”‚ â€¢ ×“×’×: FROM searchParams.model (user input!)               â”‚ â”‚
â”‚ â”‚ â€¢ ××—×™×¨: FROM webhook.××—×™×¨                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flow 3: OCR Search Results (Current - BROKEN)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER ACTION: Uploads image, receives OCR webhook                â”‚
â”‚ parts search.html: Receives webhook with dataSource='ocr'      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEBHOOK EXECUTION                                                â”‚
â”‚ â€¢ Make.com processes OCR data                                   â”‚
â”‚ â€¢ Returns JSON with part details                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEBHOOK RESPONSE (Raw OCR Data):                                â”‚
â”‚ {                                                               â”‚
â”‚   "×§×•×“_×§×˜×œ×•×’×™": "OCR-789",         â† Extracted from image     â”‚
â”‚   "×ª×™××•×¨_×—×œ×§": "×¤× ×¡ ××—×•×¨×™ ×©×××œ",   â† Extracted from image     â”‚
â”‚   "×©×_×¡×¤×§": "×¡×¤×§ ×’'",              â† From OCR                 â”‚
â”‚   "××—×™×¨": "650",                     â† From OCR                 â”‚
â”‚   "×¡×•×’_××§×•×¨": "×™×“ ×©× ×™×™×”",          â† From OCR                 â”‚
â”‚   NO "make" field âŒ                                            â”‚
â”‚   NO "year_from" field âŒ                                       â”‚
â”‚   NO "year_to" field âŒ                                         â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRANSFORM TO CATALOG FORMAT (SAME AS WEB - lines 1494-1553)    â”‚
â”‚ transformedResults = {                                          â”‚
â”‚   pcode: item.×§×•×“_×§×˜×œ×•×’×™,                                     â”‚
â”‚   cat_num_desc: item.×ª×™××•×¨_×—×œ×§,                               â”‚
â”‚   supplier_name: item.×©×_×¡×¤×§,                                 â”‚
â”‚   price: parseFloat(item.××—×™×¨),                               â”‚
â”‚   availability: item.×¡×•×’_××§×•×¨,                                â”‚
â”‚                                                                 â”‚
â”‚   // Filled from USER INPUT (searchParams), NOT OCR:          â”‚
â”‚   model: searchParams.model || '×œ× ××•×’×“×¨',  â† User input!    â”‚
â”‚   part_family: searchParams.part_group,      â† User input!    â”‚
â”‚   extracted_year: searchParams.year,         â† User input!    â”‚
â”‚                                                                 â”‚
â”‚   // MISSING - no source available:                            â”‚
â”‚   make: undefined âŒ                                            â”‚
â”‚   year_from: undefined âŒ                                       â”‚
â”‚   year_to: undefined âŒ                                         â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PREPARE PIP CONTEXT                                              â”‚
â”‚ pipContext = {                                                   â”‚
â”‚   plate: "1234567",                                             â”‚
â”‚   dataSource: 'ocr',  â† Triggers ORANGE BADGE ğŸ“„               â”‚
â”‚   searchType: 'ocr_search',                                     â”‚
â”‚   searchParams: { model, year, part_group, ... }                â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DISPLAY IN PIP                                                   â”‚
â”‚ window.partsResultsPiP.showResults(transformedResults, context) â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ×ª×•×¦××•×ª ×—×™×¤×•×© ×—×œ×§×™× ğŸ“„ OCR (ORANGE)                        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ × ××¦××• 8 ×ª×•×¦××•×ª â€¢ ×¨×›×‘: 1234567                              â”‚ â”‚
â”‚ â”‚ (NO vehicle-info subtitle shown)                            â”‚ â”‚
â”‚ â”‚     â†‘ PROBLEM: Subtitle hidden because firstResult.make     â”‚ â”‚
â”‚ â”‚       is undefined (OCR doesn't provide it)                 â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Table Displays:                                              â”‚ â”‚
â”‚ â”‚ â€¢ ×¡×¤×§: FROM OCR webhook                                     â”‚ â”‚
â”‚ â”‚ â€¢ ××¡×¤×¨ ×§×˜×œ×•×’×™: FROM OCR webhook                            â”‚ â”‚
â”‚ â”‚ â€¢ ×ª×™××•×¨: FROM OCR webhook                                  â”‚ â”‚
â”‚ â”‚ â€¢ ××©×¤×—×ª ×—×œ×§: FROM searchParams (user input!) â† WRONG!      â”‚ â”‚
â”‚ â”‚ â€¢ ×“×’×: FROM searchParams (user input!) â† SHOULD BE FROM DB! â”‚ â”‚
â”‚ â”‚ â€¢ ×©× ×”: FROM searchParams (user input!) â† SHOULD BE FROM DB! â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Comparison Table: Data Sources by Field

| Field | Catalog | Web | OCR (Current) | OCR (Should Be) |
|-------|---------|-----|--------------|-----------------|
| **pcode** | âœ… DB | âœ… Webhook | âœ… Webhook | âœ… Webhook |
| **cat_num_desc** | âœ… DB | âœ… Webhook | âœ… Webhook | âœ… Webhook |
| **supplier_name** | âœ… DB | âœ… Webhook | âœ… Webhook | âœ… Webhook |
| **price** | âœ… DB | âœ… Webhook | âœ… Webhook | âœ… Webhook |
| **availability** | âœ… DB | âœ… Webhook | âœ… Webhook | âœ… Webhook |
| **make** | âœ… DB | âŒ Missing | âŒ Missing | ğŸ”§ Fetch from vehicle DB |
| **model** | âœ… DB | âš ï¸ User input | âš ï¸ User input | ğŸ”§ Fetch from vehicle DB |
| **year_from** | âœ… DB | âŒ Missing | âŒ Missing | ğŸ”§ Fetch from vehicle DB |
| **year_to** | âœ… DB | âŒ Missing | âŒ Missing | ğŸ”§ Fetch from vehicle DB |
| **part_family** | âœ… DB | âš ï¸ User input | âš ï¸ User input | âœ… Webhook (if available) |

**Legend:**
- âœ… = Correct source
- âŒ = Missing/undefined
- âš ï¸ = Wrong source (should be from DB, not user input)
- ğŸ”§ = Needs fixing

---

## Fix Strategy: Vehicle Enrichment for OCR

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION A: Enrich in showResults() (RECOMMENDED)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

parts-search-results-pip.js:
async showResults(searchResults, searchContext = {}) {
  // ... existing code ...
  
  // NEW: Enrich OCR/web results with vehicle details
  if ((searchContext.dataSource === 'ocr' || 
       searchContext.dataSource === '××™× ×˜×¨× ×˜') && 
      this.currentPlateNumber) {
    
    console.log('ğŸš— Fetching vehicle details for plate:', this.currentPlateNumber);
    
    // Fetch from vehicle database or helper
    const vehicleDetails = await this.getVehicleDetails(this.currentPlateNumber);
    
    if (vehicleDetails && this.searchResults.length > 0) {
      // Enrich ALL results with correct vehicle data
      this.searchResults.forEach(result => {
        result.make = vehicleDetails.make;
        result.model = vehicleDetails.model;
        result.year_from = vehicleDetails.year_from;
        result.year_to = vehicleDetails.year_to;
      });
      
      console.log('âœ… Enriched results with vehicle details:', vehicleDetails);
    }
  }
  
  // ... continue with createPiPWindow() ...
}

// NEW helper function
async getVehicleDetails(plateNumber) {
  // Option 1: Query Supabase vehicle table
  const { data } = await window.supabase
    .from('vehicles')
    .select('make, model, year_from, year_to')
    .eq('plate', plateNumber)
    .single();
  
  return data;
  
  // Option 2: Get from helper (if already loaded)
  // return window.helper?.vehicle || null;
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULT: Subtitle will show correct vehicle details              â”‚
â”‚ â€¢ ×™×¦×¨×Ÿ: FROM vehicle DB (not missing)                          â”‚
â”‚ â€¢ ×“×’×: FROM vehicle DB (not user input)                        â”‚
â”‚ â€¢ ×©× ×™×: FROM vehicle DB (not missing)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Code Modification Scope

### âœ… SAFE TO MODIFY (OCR-only changes):
1. `parts-search-results-pip.js:27-70` - Add vehicle enrichment in `showResults()`
2. `parts-search-results-pip.js:246-254` - Add fallback logic in subtitle generation
3. Add new helper function `getVehicleDetails()` after line 678

### âŒ DO NOT TOUCH (working for all sources):
1. `generateResultsTableHTML()` (lines 286-373) - Table structure works for all
2. `convertCatalogToHelperFormat()` (lines 634-678) - Saves work for all
3. `getSourceBadge()` (lines 176-189) - Already works (orange badge)
4. Catalog search path (parts search.html:973-1146) - Working correctly
5. Webhook transformation (parts search.html:1494-1553) - Works for web/OCR

---

## Summary: The Issue in One Sentence

**OCR results show an orange badge but are missing vehicle details (manufacturer, year range) in the subtitle because the webhook transformation doesn't fetch this data from the vehicle database, unlike catalog results which get it from Supabase.**
