<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×™×¨×•×Ÿ ×›×™×•×£ ×©×××•×ª â€” ×‘×—×™×¨×ª ×–×¨×™××•×ª</title>
  <link rel="icon" type="image/webp" href="https://carmelcayouf.com/wp-content/uploads/2025/06/g.webp">
  <link rel="shortcut icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp">
  <link rel="apple-touch-icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg: #0f172a; 
      --card: #1e293b; 
      --card-hover: #334155;
      --muted: #475569; 
      --ink: #f1f5f9; 
      --ink-dim: #94a3b8;
      --brand: #22c55e; 
      --brand-hover: #16a34a;
      --accent: #3b82f6; 
      --accent-hover: #2563eb;
      --warn: #f59e0b; 
      --danger: #ef4444; 
      --ok: #10b981;
      --shadow: 0 10px 30px rgba(0,0,0,.35); 
      --shadow-lg: 0 20px 40px rgba(0,0,0,.4);
      --radius: 16px;
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 80% -10%, #1e293b 0%, #0b1220 60%), var(--bg);
      color: var(--ink);
      font-family: 'Heebo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, system-ui, sans-serif;
      font-weight: 400;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(180deg, rgba(11,18,32,0.95), rgba(11,18,32,0.8));
      backdrop-filter: blur(16px);
      border-bottom: 1px solid #334155;
      box-shadow: var(--shadow);
    }

    .shell {
      max-width: 1200px;
      margin: auto;
      padding: 16px;
    }

    .container {
      max-width: 520px;
      width: 90%;
      padding: 40px 20px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .row {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand img {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      object-fit: cover;
    }

    .brand h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 800;
      letter-spacing: 0.2px;
      background: linear-gradient(135deg, var(--brand), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

  
    h2 {
      font-size: 18px;
      color: #64748b;
      margin-bottom: 30px;
    }

    /* Status Ribbon */
    .ribbon {
      margin-top: 12px;
      background: linear-gradient(90deg, var(--card), #1a2332);
      border: 1px solid #334155;
      border-radius: 14px;
      padding: 10px 14px;
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid #334155;
      color: var(--ink);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--warn);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Main Content */
    main {
      padding: 24px 0;
    }

    /* Quick Actions */
    .quick {
      display: grid;
      grid-template-columns: 1fr 1fr auto auto auto;
      gap: 12px;
      align-items: center;
    }

    @media (max-width: 768px) {
      .quick {
        grid-template-columns: 1fr;
        gap: 8px;
      }
    }

    .input, .select {
      appearance: none;
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid #334155;
      background: var(--card);
      color: var(--ink);
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .input:focus, .select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
      border: 0;
      border-radius: 12px;
      padding: 14px 20px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--brand);
      color: #0a0f0a;
    }

    .btn-primary:hover {
      background: var(--brand-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .btn-ghost {
      background: var(--card);
      color: var(--ink);
      border: 1px solid #334155;
    }

    .btn-ghost:hover {
      background: var(--card-hover);
      border-color: var(--accent);
    }

    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    /* Cards */
    .card {
      background: linear-gradient(180deg, var(--card), #1a2332);
      border: 1px solid #334155;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      transition: all 0.3s ease;
      position: relative;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: #475569;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 20px;
      font-weight: 800;
      color: var(--ink);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sub {
      color: var(--ink-dim);
      font-size: 14px;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    /* Collapsible Cards */
    .collapsible .card-header {
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: -24px -24px 20px -24px;
      padding: 20px 24px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(34, 197, 94, 0.1));
      border-radius: var(--radius) var(--radius) 0 0;
      border-bottom: 1px solid #334155;
    }

    .collapsible .card-header:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(34, 197, 94, 0.15));
    }

    .collapse-icon {
      transition: transform 0.3s ease;
      font-size: 18px;
      color: var(--accent);
    }

    .collapsible.collapsed .collapse-icon {
      transform: rotate(-180deg);
    }

    .collapsible.collapsed .card-content {
      display: none;
    }

    /* Steps */
    .steps {
      display: grid;
      gap: 12px;
      margin: 16px 0;
    }

    .step {
      display: grid;
      grid-template-columns: 40px 1fr auto;
      gap: 12px;
      align-items: center;
      padding: 16px;
      border-radius: 12px;
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid #334155;
      transition: all 0.2s ease;
    }

    .step:hover {
      background: rgba(30, 41, 59, 0.8);
      border-color: var(--accent);
    }

    .step .ico {
      width: 32px;
      height: 32px;
      display: grid;
      place-items: center;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--brand));
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .step .name {
      font-weight: 600;
      color: var(--ink);
    }

    .step .hint {
      font-size: 12px;
      color: var(--ink-dim);
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid;
      font-weight: 600;
    }

    .chip.ok { 
      color: var(--ok); 
      border-color: var(--ok); 
      background: rgba(16, 185, 129, 0.1);
    }
    
    .chip.warn { 
      color: var(--warn); 
      border-color: var(--warn); 
      background: rgba(245, 158, 11, 0.1);
    }
    
    .chip.danger { 
      color: var(--danger); 
      border-color: var(--danger); 
      background: rgba(239, 68, 68, 0.1);
    }

    .chip:not(.ok):not(.warn):not(.danger) {
      color: var(--ink-dim);
      border-color: #475569;
      background: rgba(71, 85, 105, 0.1);
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    @media (max-width: 480px) {
      .toolbar {
        flex-direction: column;
      }
    }

    /* Tools Grid - IMPROVED VISIBILITY */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .tool {
      background: linear-gradient(135deg, var(--card), #2a3441);
      border: 2px solid #475569;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      text-decoration: none;
      color: inherit;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .tool::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--brand), var(--accent));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .tool:hover {
      background: linear-gradient(135deg, var(--card-hover), #334155);
      border-color: var(--accent);
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }

    .tool:hover::before {
      opacity: 1;
    }

    .tool h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      color: var(--ink);
    }

    .tool .desc {
      font-size: 13px;
      color: var(--ink-dim);
      line-height: 1.4;
    }

    /* Pills and Shortcuts */
    .pills {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 16px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 16px 24px;
      border-radius: 999px;
      border: 2px solid #334155;
      background: var(--card);
      color: var(--ink);
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      min-width: 180px;
    }

    .pill-lg {
      padding: 20px 32px;
      font-size: 16px;
      min-width: 200px;
    }

    .pill:hover {
      background: var(--card-hover);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Modal */
    dialog {
      border: 1px solid #334155;
      border-radius: var(--radius-lg);
      background: var(--card);
      color: var(--ink);
      padding: 0;
      max-width: 1000px;
      width: 96vw;
      box-shadow: var(--shadow-lg);
    }

    dialog::backdrop {
      background: rgba(2,6,23,.8);
      backdrop-filter: blur(4px);
    }

    .modal-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid #334155;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(34, 197, 94, 0.1));
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .modal-body {
      padding: 24px;
    }

    /* Footer */
    footer {
      opacity: 0.8;
      padding: 32px 0;
      border-top: 1px solid #334155;
      margin-top: 40px;
      font-size: 13px;
      text-align: center;
      background: linear-gradient(180deg, transparent, rgba(15, 23, 42, 0.5));
    }

    .footer-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .footer-logo {
      width: 24px;
      height: 24px;
      border-radius: 6px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .shell {
        padding: 12px;
      }
      
      .brand h1 {
        font-size: 18px;
      }
      
      .card {
        padding: 20px;
      }
      
      .collapsible .card-header {
        margin: -20px -20px 16px -20px;
        padding: 16px 20px;
      }
      
      .tools-grid {
        grid-template-columns: 1fr;
      }
      
      .pills {
        flex-direction: column;
        align-items: center;
      }
      
      .pill, .pill-lg {
        width: 100%;
        max-width: 300px;
      }
    }

    @media (max-width: 480px) {
      .ribbon {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      
      .badge {
        justify-content: center;
      }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      .dot {
        animation: none;
      }
    }

    /* High contrast mode */
    @media (prefers-contrast: high) {
      :root {
        --bg: #000;
        --card: #111;
        --ink: #fff;
        --brand: #0f0;
        --accent: #00f;
      }
    }

    /* Hidden utility */
    .vh {
      position: absolute !important;
      left: -9999px !important;
      top: auto !important;
      width: 1px !important;
      height: 1px !important;
      overflow: hidden !important;
    }
  </style>
</head>
<body>
  <header>
    <div class="shell">
      <div class="row">
        <div class="brand">
          <div class="container">
  <img class="logo" src="https://carmelcayouf.com/wp-content/uploads/2025/06/g.webp" alt="Logo"/>
  <h1>×™×¨×•×Ÿ ×›×™×•×£ ×©×××•×ª - ×¤×•×¨×˜×œ</h1>
  <h2>×©×××•×ª ×•×”×¢×¨×›×ª × ×–×§×™ ×¨×›×‘ ×•×¨×›×•×©</h2>
        </div>
        <div class="row" style="margin-inline-start:auto">
          <button class="btn btn-ghost" id="btnVehicle">ğŸ“‹ ×¤×¨×˜×™ ×”×¨×›×‘</button>
          <button class="btn btn-ghost" id="btnReports">ğŸ“„ ××¡××›×™× ××—×¨×•× ×™×</button>
          <button class="btn btn-primary" id="btnLogout">ğŸšª ×”×ª× ×ª×§</button>
        </div>
      </div>
      <div class="ribbon" id="ribbon">
        <span class="badge"><span class="dot" id="dot-status"></span> ×¡×˜×˜×•×¡ ×ª×™×§: <strong id="caseStatus">×”×ª×—×œ×”</strong></span>
        <span class="badge">ğŸš— ×œ×•×—×™×ª: <strong id="casePlate">â€”</strong></span>
        <span class="badge">ğŸ‘¤ ×‘×¢×œ×™×: <strong id="caseOwner">â€”</strong></span>
        <span class="badge">ğŸ“… ×ª××¨×™×š ×‘×“×™×§×”: <strong id="caseDate">â€”</strong></span>
      </div>
    </div>
  </header>

  <main class="shell">
    <!-- Quick Case Loader -->
    <section class="card" aria-labelledby="quick-nav-title">
      <h2 id="quick-nav-title">ğŸ¯ ×˜×¢×™× ×ª ×ª×™×§ ×§×™×™× / ×¤×ª×™×—×ª ×ª×™×§ ×—×“×©</h2>
      <p class="sub">×”×–×Ÿ ×¤×¨×˜×™× ×œ×”×ª×—×œ×ª ×¢×‘×•×“×” ××• ×œ×˜×¢×™× ×ª ×ª×™×§ ×§×™×™× ××”××¢×¨×›×ª</p>
      <div class="quick">
        <input id="plate" class="input" placeholder="××¡×¤×¨ ×¨×›×‘ (7-8 ×¡×¤×¨×•×ª)" inputmode="numeric" required/>
        <input id="owner" class="input" placeholder="×©×/×ª ×‘×¢×œ/×ª ×”×¨×›×‘" required/>
        <input id="date" class="input" type="date" required/>
        <select id="location" class="select" required>
          <option value="">×‘×—×¨ ××§×•× ×‘×“×™×§×”</option>
          <option>×—×™×¤×”</option>
          <option>×ª×œ ××‘×™×‘</option>
          <option>×™×¨×•×©×œ×™×</option>
          <option>× ×ª× ×™×”</option>
          <option>×‘××¨ ×©×‘×¢</option>
          <option>××—×¨</option>
        </select>
        <button id="btnStart" class="btn btn-primary">ğŸš€ ×˜×¢×Ÿ/×¦×•×¨ ×ª×™×§</button>
      </div>
    </section>

    <!-- Admin & Assistant Shortcuts -->
    <section class="card shortcuts">
      <h2>âš¡ ×§×™×¦×•×¨×™ ×“×¨×š ××”×™×¨×™×</h2>
      <div class="pills">
        <a class="pill pill-lg" id="pill-admin" href="admin.html">âš™ï¸ ××¨×›×– × ×™×”×•×œ (Admin)</a>
        <button class="pill pill-lg" id="pill-nicole">ğŸ¤– ×©××œ ××ª × ×™×§×•×œ â€” ×× ×”×œ×ª ×”×™×“×¢</button>
      </div>
    </section>

    <!-- Existing Reports -->
    <section class="card reports">
      <h2>ğŸ“Š ×ª×¦×•×’×ª ×“×•"×—×•×ª ×§×™×™××™×</h2>
      <p class="sub">×œ×—×¥ ×¢×œ ×›×œ ×›×¤×ª×•×¨ ×œ×¤×ª×™×—×ª PDF ×‘××¦×‘ ×¦×£</p>
      <div class="pills">
        <button class="pill" data-report="estimate">ğŸ“‹ ××•××“×Ÿ</button>
        <button class="pill" data-report="expertise">ğŸ” ××§×¡×¤×¨×˜×™×–×”</button>
        <button class="pill" data-report="final">ğŸ“‘ ×—×•×•×ª ×“×¢×ª ×¡×•×¤×™×ª</button>
      </div>
    </section>

    <!-- Main Workflow Sections - COLLAPSIBLE -->
    <section class="grid" aria-label="×–×¨×™××•×ª ×¢×‘×•×“×” ×¨××©×™×•×ª">
      
      <!-- Expertise Flow -->
      <article class="card collapsible" id="wf-expertise">
        <div class="card-header" data-target="expertise">
          <h2>ğŸ” ×¤×ª×™×—×ª ××§×¡×¤×¨×˜×™×–×”</h2>
          <span class="collapse-icon">â–¼</span>
        </div>
        <div class="card-content">
          <p class="sub">×”×‘×¡×™×¡ ×œ×›×œ ×”×ª×”×œ×™×š. ×™×•×¦×¨ × ×ª×•× ×™ ×¨×›×‘ ×•×××¤×™×™× ×™×, ××˜××™×¢ × ×ª×•× ×™ ×¨×›×‘ ×•×¤×•×ª×— ××•×§×“×™ × ×–×§.</p>
          <div class="steps">
            <div class="step">
              <span class="ico">ğŸ”‘</span>
              <div>
                <div class="name">××™××•×ª + ×¤×ª×™×—×ª ×ª×™×§</div>
                <div class="hint">×–×™×”×•×™ ×¨×›×‘ ×•×™×¦×™×¨×ª ××‘× ×” ×ª×™×§</div>
              </div>
              <span class="chip ok" id="st-open">××•×›×Ÿ</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ“</span>
              <div>
                <div class="name">×¤×¨×˜×™× ×›×œ×œ×™×™×</div>
                <div class="hint">××™×“×¢ ×‘×¡×™×¡×™ ×¢×œ ×”×¨×›×‘ ×•×”× ×–×§</div>
              </div>
              <button class="btn btn-ghost go" data-href="general_info.html">×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">ğŸ“„</span>
              <div>
                <div class="name">×“×•"×— ×œ×•×™ ×™×¦×—×§</div>
                <div class="hint">×©×•×•×™ ×©×•×§ ×•× ×ª×•× ×™ ×™×¨×™×“×ª ×¢×¨×š</div>
              </div>
              <button class="btn btn-ghost go" data-href="upload-levi.html">×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">ğŸ§­</span>
              <div>
                <div class="name">××©×£ ××•×§×“×™ × ×–×§</div>
                <div class="hint">×ª×™×¢×•×“ ××¤×•×¨×˜ ×©×œ ×›×œ × ×–×§</div>
              </div>
              <button class="btn btn-ghost go" data-href="damage-centers-wizard.html">×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">âœ…</span>
              <div>
                <div class="name">××™××•×ª ××§×¡×¤×¨×˜×™×–×”</div>
                <div class="hint">×‘×“×™×§×•×ª ××¢×¨×›×ª + ××™×©×•×¨ ××©×ª××©</div>
              </div>
              <span class="chip" id="st-exp-validate">× ×¢×•×œ</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ“¤</span>
              <div>
                <div class="name">×¡×§×™×¨×” + ×©×œ×™×—×”</div>
                <div class="hint">×‘× ×™×™×” ×¡×•×¤×™×ª ×•×—×ª×™××” ×“×™×’×™×˜×œ×™×ª</div>
              </div>
              <span class="chip" id="st-exp-submit">× ×¢×•×œ</span>
            </div>
          </div>
          <div class="toolbar">
            <button class="btn btn-primary" id="cta-expertise">ğŸš€ ×”×ª×—×œ ××§×¡×¤×¨×˜×™×–×”</button>
            <button class="btn btn-ghost" id="cta-exp-continue">â†©ï¸ ×”××©×š ××§×¡×¤×¨×˜×™×–×”</button>
          </div>
        </div>
      </article>

      <!-- Estimate Flow -->
      <article class="card collapsible" id="wf-estimate">
        <div class="card-header" data-target="estimate">
          <h2>ğŸ“‹ ×‘× ×™×™×ª ××•××“×Ÿ (××•×¤×¦×™×•× ×œ×™)</h2>
          <span class="collapse-icon">â–¼</span>
        </div>
        <div class="card-content">
          <p class="sub">××•××“×Ÿ ×œ×¤× ×™ ×—×©×‘×•× ×™×ª. × × ×¢×œ ××•×˜×•××˜×™×ª ×›××©×¨ ××ª×§×‘×œ×ª ×—×©×‘×•× ×™×ª ×××•×¡×š.</p>
          <div class="steps">
            <div class="step">
              <span class="ico">ğŸ‘ï¸â€ğŸ—¨ï¸</span>
              <div>
                <div class="name">×¡×§×™×¨×ª ×“×¨××¤×˜</div>
                <div class="hint">×•×•×“× ×©×”××§×¡×¤×¨×˜×™×–×” ×”×•×©×œ××”</div>
              </div>
              <span class="chip" id="st-draft">×“×•×¨×© ×“×¨××¤×˜</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ“</span>
              <div>
                <div class="name">×‘×•× ×” ××•××“×Ÿ</div>
                <div class="hint">×—×™×©×•×‘×™ ×¢×œ×•×™×•×ª ×•×©×¢×•×ª ×¢×‘×•×“×”</div>
              </div>
              <button class="btn btn-ghost go" data-href="estimate-builder.html" disabled>×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">âœ…</span>
              <div>
                <div class="name">××™××•×ª ××•××“×Ÿ</div>
                <div class="hint">×‘×“×™×§×•×ª ××ª××˜×™×•×ª ×•××©×¤×˜×™×•×ª</div>
              </div>
              <span class="chip" id="st-est-validate">× ×¢×•×œ</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ“¤</span>
              <div>
                <div class="name">×¡×§×™×¨×” + ×©×œ×™×—×”</div>
                <div class="hint">×™×¦×•× PDF ×•×”×¢×‘×¨×” ×œ×œ×§×•×—</div>
              </div>
              <span class="chip" id="st-est-submit">× ×¢×•×œ</span>
            </div>
          </div>
          <div class="toolbar">
            <button class="btn btn-primary" id="cta-estimate" disabled>ğŸ“‹ ×¤×ª×— ××•××“×Ÿ</button>
            <button class="btn btn-ghost" id="cta-est-continue" disabled>â†©ï¸ ×”××©×š ××•××“×Ÿ</button>
          </div>
        </div>
      </article>

      <!-- Final Report Flow -->
      <article class="card collapsible" id="wf-final">
        <div class="card-header" data-target="final">
          <h2>ğŸ“‘ ×—×•×•×ª ×“×¢×ª ×¡×•×¤×™×ª</h2>
          <span class="collapse-icon">â–¼</span>
        </div>
        <div class="card-content">
          <p class="sub">×™×¢×“ ×”××¢×¨×›×ª ×”×¡×•×¤×™. ×—×™×‘×•×¨ ×›×œ ×”× ×ª×•× ×™×, ×™×¨×™×“×ª ×¢×¨×š, ×©×›"×˜ ×•××¡×’×¨×•×ª ××©×¤×˜×™×•×ª.</p>
          <div class="steps">
            <div class="step">
              <span class="ico">ğŸ‘ï¸</span>
              <div>
                <div class="name">×¡×§×™×¨×ª ×“×¨××¤×˜ ××—×¨×•×Ÿ</div>
                <div class="hint">××™××•×ª × ×ª×•× ×™ ×‘×¡×™×¡</div>
              </div>
              <span class="chip" id="st-final-draft">×“×•×¨×© ×“×¨××¤×˜</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ“‰</span>
              <div>
                <div class="name">×‘×•× ×” ×—×•×•×ª ×“×¢×ª ×¡×•×¤×™×ª</div>
                <div class="hint">×—×™×©×•×‘×™ ×™×¨×™×“×ª ×¢×¨×š ×•××¡×§× ×•×ª</div>
              </div>
              <button class="btn btn-ghost go" data-href="final-report-builder.html" disabled>×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">ğŸ’¼</span>
              <div>
                <div class="name">××•×“×•×œ ×©×›"×˜/××’×¨×•×ª</div>
                <div class="hint">×—×™×©×•×‘ ×¢×œ×•×™×•×ª × ×œ×•×•×ª</div>
              </div>
              <button class="btn btn-ghost go" data-href="fee-module.html" disabled>×¤×ª×—</button>
            </div>
            <div class="step">
              <span class="ico">ğŸ›¡ï¸</span>
              <div>
                <div class="name">××™××•×ª ×¡×•×¤×™</div>
                <div class="hint">×‘×“×™×§×•×ª ××—×¨×•× ×•×ª ×•×˜×§×¡×˜ ××©×¤×˜×™</div>
              </div>
              <span class="chip" id="st-final-validate">× ×¢×•×œ</span>
            </div>
            <div class="step">
              <span class="ico">ğŸ§¾</span>
              <div>
                <div class="name">×¡×’×™×¨×” ×•×”×¤×§×ª PDF</div>
                <div class="hint">×™×¦×•× ××¡××š ×¡×•×¤×™ ××—×•×ª×</div>
              </div>
              <button class="btn btn-ghost go" data-href="final-report-template-builder.html" disabled>×¤×ª×—</button>
            </div>
          </div>
          <div class="toolbar">
            <button class="btn btn-primary" id="cta-final" disabled>ğŸ“‘ ×¤×ª×— ×—×•×•"×“</button>
            <button class="btn btn-ghost" id="cta-final-continue" disabled>â†©ï¸ ×”××©×š ×—×•×•"×“</button>
          </div>
        </div>
      </article>

      <!-- Tools Section - IMPROVED COLORS -->
      <article class="card collapsible" id="tools">
        <div class="card-header" data-target="tools">
          <h2>ğŸ› ï¸ ×›×œ×™× ×•×›×œ×™× × ×•×¡×¤×™×</h2>
          <span class="collapse-icon">â–¼</span>
        </div>
        <div class="card-content">
          <p class="sub">×›×œ×™× ×¢×–×¨ ×œ×ª×™×¢×•×“, ×—×™×¤×•×© ×•×¢×™×‘×•×“ × ×ª×•× ×™× ×‘××”×œ×š ×”×ª×”×œ×™×š</p>
          <div class="tools-grid">
            <a class="tool" href="parts-search.html">
              <h3>ğŸ” ××•×“×•×œ ×—×™×¤×•×© ×—×œ×§×™×</h3>
              <span class="desc">×§×˜×œ×•×’×™× ××ª×§×“××™× ×•×—×™×¤×•×© AI ××•× ×—×”</span>
            </a>
            <a class="tool" href="upload-images.html">
              <h3>ğŸ“¸ ××•×“×•×œ ×ª××•× ×•×ª</h3>
              <span class="desc">×¦×™×œ×•×, ×’×œ×¨×™×” ×•×¡×™××•×Ÿ ××•×˜×•××˜×™</span>
            </a>
            <a class="tool" href="invoice-upload.html">
              <h3>ğŸ§¾ ×”×¢×œ××ª ×—×©×‘×•× ×™×ª</h3>
              <span class="desc">OCR ××•×˜×•××˜×™ ×•×”×—×œ×¤×ª ××•××“×Ÿ</span>
            </a>
            <a class="tool" href="upload-levi.html">
              <h3>ğŸ“Š ×”×¢×œ××ª ×“×•"×— ×œ×•×™ ×™×¦×—×§</h3>
              <span class="desc">×©××™×‘×” ××•×˜×•××˜×™×ª ×•×¢×“×›×•×Ÿ × ×ª×•× ×™×</span>
            </a>
            <a class="tool" href="damage-center-works.html">
              <h3>ğŸ”§ ×¢×‘×•×“×•×ª × ×“×¨×©×•×ª</h3>
              <span class="desc">× ×™×”×•×œ ×¢×‘×•×“×•×ª ×ª×™×§×•×Ÿ ×•×©×¢×•×ª</span>
            </a>
            <a class="tool" href="damage-center-repairs.html">
              <h3>ğŸ› ï¸ ×ª×™×§×•× ×™× × ×“×¨×©×™×</h3>
              <span class="desc">×¨×©×™××ª ×ª×™×§×•× ×™× ×•×¢×œ×•×™×•×ª</span>
            </a>
            <a class="tool" href="parts-required.html">
              <h3>âš™ï¸ ×—×œ×§×™× × ×“×¨×©×™×</h3>
              <span class="desc">××¢×§×‘ ×—×œ×§×™× ×•×”×–×× ×•×ª</span>
            </a>
            <a class="tool" href="external-sites.html">
              <h3>ğŸŒ ×“×¤×“×¤×Ÿ ××ª×¨×™× ×—×™×¦×•× ×™×™×</h3>
              <span class="desc">×’×™×©×” ××”×™×¨×” ×œ××ª×¨×™ ×¢×–×¨</span>
            </a>
          </div>
        </div>
      </article>
    </section>

    <!-- Modals -->
    <dialog id="mdlVehicle" aria-labelledby="vehTitle">
      <div class="modal-head">
        <strong id="vehTitle">×¤×¨×˜×™ ×”×¨×›×‘</strong>
        <button class="btn btn-ghost" data-close>âœ• ×¡×’×•×¨</button>
      </div>
      <div class="modal-body">
        <div id="vehBody">â€”</div>
      </div>
    </dialog>

    <dialog id="pdfModal" aria-label="PDF viewer" style="height:85vh">
      <div class="modal-head">
        <strong>×ª×¦×•×’×ª PDF</strong>
        <button class="btn btn-ghost" data-close>âœ• ×¡×’×•×¨</button>
      </div>
      <div class="modal-body" style="height:calc(85vh - 56px)">
        <iframe id="pdfFrame" src="" style="width:100%;height:100%;border:0" title="PDF"></iframe>
      </div>
    </dialog>

    <dialog id="mdlReports" aria-labelledby="repTitle">
      <div class="modal-head">
        <strong id="repTitle">××¡××›×™× ××—×¨×•× ×™×</strong>
        <button class="btn btn-ghost" data-close>âœ• ×¡×’×•×¨</button>
      </div>
      <div class="modal-body">
        <ul id="repList" style="list-style:none;padding:0;margin:0;display:grid;gap:8px"></ul>
      </div>
    </dialog>

    <!-- Dev Panel -->
    <div id="devPanel" class="card" style="display:none;margin-top:16px">
      <h2>ğŸ”§ Dev: ×¡×™××•×œ×¦×™×”</h2>
      <div class="row" style="gap:18px;flex-wrap:wrap">
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="dep-expertise"> expertise ×§×™×™×
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="dep-draft"> draft ×§×™×™×
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="dep-estimate"> estimate ×§×™×™×
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="dep-levi"> ×“×•×´×— ×œ×•×™
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="dep-invoice"> ×—×©×‘×•× ×™×ª ×§×™×™××ª
        </label>
      </div>
    </div>
  </main>

  <!-- Footer with proper branding -->
  <footer>
    <div class="shell">
      <div class="footer-content">
        <img src="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp" alt="×œ×•×’×• ×™×¨×•×Ÿ ×›×™×•×£" class="footer-logo" onerror="this.style.display='none'"/>
        <span>All rights reserved Â© Carmel Cayouf</span>
    
        <span id="currentYear"></span>
      </div>
    </div>
  </footer>

  <!-- Nicole Assistant Panel -->
  <dialog id="nicole-panel" class="sidepanel" aria-label="Nicole assistant">
    <div class="panel-header">
      <h3>ğŸ¤– Nicole â€” ×× ×”×œ×ª ×”×™×“×¢</h3>
      <button id="close-nicole" class="btn btn-ghost" aria-label="×¡×’×•×¨">âœ•</button>
    </div>
    <div class="panel-body">
      <ul class="nicole-feed" style="list-style:none;margin:0;padding:0;display:grid;gap:12px">
        <li style="padding:12px;background:rgba(34,197,94,0.1);border:1px solid var(--ok);border-radius:8px;color:var(--ink)">
          âœ… ×¤×¢×•×œ×” ×”×‘××”: ×”×©×œ× ×“×•"×— ×œ×•×™ ×¢×‘×•×¨ ×”×ª×™×§ ×”× ×•×›×—×™
        </li>
        <li style="padding:12px;background:rgba(245,158,11,0.1);border:1px solid var(--warn);border-radius:8px;color:var(--ink)">
          âš ï¸ ×—×¡×¨×” ×—×©×‘×•× ×™×ª. ×”××•××“×Ÿ × ×©××¨ ×–×× ×™
        </li>
      </ul>
      <div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap">
        <a class="btn btn-ghost" href="upload-levi.html">ğŸ“„ ×¤×ª×— ×œ×•×™</a>
        <a class="btn btn-ghost" href="invoice-upload.html">ğŸ§¾ ×”×¢×œ×” ×—×©×‘×•× ×™×ª</a>
      </div>
    </div>
  </dialog>

  <!-- Enhanced JavaScript -->
  <script type="module">
  if (!window.__YK_SELECTION_INIT__) {
    window.__YK_SELECTION_INIT__ = true;

    // Set current year in footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // Utilities
    const qs = (s, el=document)=>el.querySelector(s);
    const qsa = (s, el=document)=>[...el.querySelectorAll(s)];
    const state = {
      case:{ plate:"", owner:"", date:"", location:"", status:"×”×ª×—×œ×”" },
      deps:{expertise:false, draft:false, estimate:false, invoice:false, levi:false},
      reports:[]
    };

    function persist(){ 
      if(!state.case.plate) return; 
      localStorage.setItem("yk_case_"+state.case.plate, JSON.stringify(state)); 
    }
    
    function load(plate){ 
      const raw = localStorage.getItem("yk_case_"+plate); 
      if(!raw) return false; 
      const saved = JSON.parse(raw); 
      Object.assign(state.case, saved.case||{}); 
      Object.assign(state.deps, saved.deps||{}); 
      state.reports = saved.reports||[]; 
      return true; 
    }

    // Collapsible functionality
    function initCollapsibles() {
      qsa('.collapsible .card-header').forEach(header => {
        header.addEventListener('click', () => {
          const card = header.closest('.collapsible');
          const isCollapsed = card.classList.toggle('collapsed');
          
          // Save collapsed state
          const target = header.dataset.target;
          localStorage.setItem(`collapsed_${target}`, isCollapsed);
        });
        
        // Restore collapsed state
        const target = header.dataset.target;
        const isCollapsed = localStorage.getItem(`collapsed_${target}`) === 'true';
        if (isCollapsed) {
          header.closest('.collapsible').classList.add('collapsed');
        }
      });
    }

    // Ribbon status
    function fillRibbon(){
      qs('#casePlate').textContent = state.case.plate || 'â€”';
      qs('#caseOwner').textContent = state.case.owner || 'â€”';
      qs('#caseDate').textContent = state.case.date || 'â€”';
      qs('#caseStatus').textContent = state.case.status;
      
      // Dynamic dot color with animation
      const dot = qs('#dot-status');
      if (state.deps.invoice) {
        dot.style.background = 'var(--ok)';
      } else if (state.deps.estimate || state.deps.draft) {
        dot.style.background = 'var(--warn)';
      } else {
        dot.style.background = '#64748b';
      }
    }

    // Dependencies logic
    function applyDeps(){
      const expReady = state.deps.expertise && state.deps.levi;
      
      // Update step statuses
      if (qs('#st-exp-validate')) qs('#st-exp-validate').textContent = expReady ? '××•×›×Ÿ' : '× ×¢×•×œ';
      if (qs('#st-exp-submit')) qs('#st-exp-submit').textContent = expReady ? '××•×›×Ÿ' : '× ×¢×•×œ';
      
      // Update step chips
      if (qs('#st-exp-validate')) {
        qs('#st-exp-validate').className = expReady ? 'chip ok' : 'chip';
      }

      // Damage center button
      const dmgBtn = document.querySelector('#wf-expertise .go[data-href*="damage"]');
      if(dmgBtn) dmgBtn.disabled = !state.deps.levi;

      // Draft status
      if (qs('#st-draft')) {
        qs('#st-draft').textContent = state.deps.draft ? '××•×›×Ÿ' : '×“×•×¨×© ×“×¨××¤×˜';
        qs('#st-draft').className = state.deps.draft ? 'chip ok' : 'chip warn';
      }
      
      // Estimate buttons
      qsa('#wf-estimate .go').forEach(b=>b.disabled = !state.deps.draft);
      if (qs('#cta-estimate')) qs('#cta-estimate').disabled = !state.deps.draft;
      if (qs('#cta-est-continue')) qs('#cta-est-continue').disabled = !state.deps.draft;

      // Invoice override message
      if(state.deps.invoice && qs('#wf-estimate .sub')){ 
        qs('#wf-estimate .sub').innerHTML = 'âœ… ×”×ª×§×‘×œ×” ×—×©×‘×•× ×™×ª â€” ×¢×¨×›×™ ××•××“×Ÿ ×™×•×—×œ×¤×• (××™×“×¢ ×”×™×¡×˜×•×¨×™ ×‘×œ×‘×“).'; 
      }

      // Final report
      const finalOk = state.deps.draft;
      if (qs('#st-final-draft')) {
        qs('#st-final-draft').textContent = finalOk ? '××•×›×Ÿ' : '×“×•×¨×© ×“×¨××¤×˜';
        qs('#st-final-draft').className = finalOk ? 'chip ok' : 'chip warn';
      }
      
      qsa('#wf-final .go').forEach((b,i)=>{ if(i===0) return; b.disabled = !finalOk; });
      if (qs('#cta-final')) qs('#cta-final').disabled = !finalOk; 
      if (qs('#cta-final-continue')) qs('#cta-final-continue').disabled = !finalOk;

      if(state.deps.invoice && qs('#wf-final .sub')){ 
        qs('#wf-final .sub').innerHTML = 'ğŸ’¡ ××•××œ×¥ ×œ×”×©×œ×™× ×™×¨×™×“×ª ×¢×¨×š ×•×©×›"×˜ ×œ××—×¨ ×§×œ×™×˜×ª ×—×©×‘×•× ×™×ª.'; 
      }

      // Update case status
      if(state.deps.invoice){ state.case.status='âœ… ××•×›×Ÿ ×œ×¡×’×™×¨×”'; }
      else if(state.deps.expertise && !state.deps.levi){ state.case.status='ğŸ“„ ×“×•×¨×© ×“×•×´×— ×œ×•×™'; }
      else if(state.deps.estimate || state.deps.draft){ state.case.status='âš™ï¸ ×‘×ª×”×œ×™×š'; }
      else { state.case.status='ğŸš€ ×”×ª×—×œ×”'; }
      
      fillRibbon();
      persist();
    }

    // Actions
    function startOrLoadCase(){
      const plateInput = qs('#plate');
      const p = plateInput.value.trim();
      
      // Validate Israeli license plate (7-8 digits)
      if(!p || !/^\d{7,8}$/.test(p)){ 
        alert('×”×›× ×¡ ××¡×¤×¨ ×¨×›×‘ ×ª×§×™×Ÿ (7-8 ×¡×¤×¨×•×ª)'); 
        plateInput.focus();
        return; 
      }
      
      const exists = load(p);
      state.case.plate = p;
      state.case.owner = qs('#owner').value.trim() || (exists? state.case.owner : '');
      state.case.date  = qs('#date').value || (exists? state.case.date : new Date().toISOString().slice(0,10));
      state.case.location = qs('#location').value || state.case.location;
      
      if(!exists){ 
        state.deps = {expertise:false, draft:false, estimate:false, invoice:false, levi:false}; 
        state.reports = []; 
      }
      
      applyDeps();
      
      const btnStart = qs('#btnStart');
      btnStart.textContent = exists ? 'âœ… ×ª×™×§ × ×˜×¢×Ÿ' : 'ğŸ†• ×ª×™×§ × ×•×¦×¨';
      btnStart.style.background = exists ? 'var(--ok)' : 'var(--brand)';
      
      setTimeout(()=>{
        btnStart.textContent='ğŸš€ ×˜×¢×Ÿ/×¦×•×¨ ×ª×™×§';
        btnStart.style.background = 'var(--brand)';
      }, 2000);
    }

    function openModal(el){ el.showModal(); }
    function closeModal(el){ el.close(); }

    function vehicleDetailsHtml(){
      return `
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
        <div style="padding:12px;background:rgba(59,130,246,0.1);border-radius:8px">
          <strong style="color:var(--accent)">ğŸš— ×œ×•×—×™×ª:</strong><br> ${state.case.plate||'â€”'}
        </div>
        <div style="padding:12px;background:rgba(34,197,94,0.1);border-radius:8px">
          <strong style="color:var(--ok)">ğŸ‘¤ ×‘×¢×œ×™×:</strong><br> ${state.case.owner||'â€”'}
        </div>
        <div style="padding:12px;background:rgba(245,158,11,0.1);border-radius:8px">
          <strong style="color:var(--warn)">ğŸ­ ×™×¦×¨×Ÿ/×“×’×:</strong><br> ×¤×™×’'×• 308
        </div>
        <div style="padding:12px;background:rgba(168,85,247,0.1);border-radius:8px">
          <strong style="color:#a855f7">ğŸ“… ×©× ×”:</strong><br> 2022
        </div>
        <div style="padding:12px;background:rgba(236,72,153,0.1);border-radius:8px">
          <strong style="color:#ec4899">ğŸ”¢ VIN:</strong><br> VF3â€¢â€¢â€¢
        </div>
        <div style="padding:12px;background:rgba(34,197,94,0.1);border-radius:8px">
          <strong style="color:var(--ok)">ğŸ’° ×©×•×•×™ ×©×•×§ (×œ×•×™):</strong><br> 88,000 â‚ª
        </div>
      </div>`
    }

    function reportsListHtml(){
      if(!state.reports.length){
        return '<li style="padding:20px;text-align:center;color:var(--ink-dim)">ğŸ“„ ××™×Ÿ ××¡××›×™× ×œ×”×¦×’×” ×›×¨×’×¢</li>'
      }
      return state.reports.map(r=>
        `<li><a class="btn btn-ghost" href="${r.href}" target="_blank" style="width:100%;justify-content:flex-start">${r.name}</a></li>`
      ).join('');
    }

    function buildPdfUrl(type){
      const plate = state.case.plate || 'xxxxx';
      return `/pdf/${plate}_${type}.pdf`;
    }

    function paramCase(){
      const params = new URLSearchParams();
      if(state.case.plate) params.set('plate', state.case.plate);
      if(state.case.date) params.set('date', state.case.date);
      if(state.case.owner) params.set('owner', state.case.owner);
      if(state.case.location) params.set('location', state.case.location);
      return '?' + params.toString();
    }

    // Event Listeners
    qs('#btnStart').addEventListener('click', startOrLoadCase);
    
    qs('#btnVehicle').addEventListener('click', ()=>{ 
      qs('#vehBody').innerHTML = vehicleDetailsHtml(); 
      openModal(qs('#mdlVehicle')); 
    });
    
    qs('#btnReports').addEventListener('click', ()=>{ 
      qs('#repList').innerHTML = reportsListHtml(); 
      openModal(qs('#mdlReports')); 
    });
    
    qs('#btnLogout').addEventListener('click', ()=>{
      if(confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§?')){
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'index.html';
      }
    });

    qsa('[data-close]').forEach(b=> b.addEventListener('click', e=> closeModal(e.target.closest('dialog'))));

    // Nicole assistant
    const pillNicole = document.getElementById('pill-nicole');
    if (pillNicole) {
      pillNicole.addEventListener('click', () => {
        openModal(document.getElementById('nicole-panel'));
      });
    }

    const closeNicole = document.getElementById('close-nicole');
    if (closeNicole) {
      closeNicole.addEventListener('click', () => {
        closeModal(document.getElementById('nicole-panel'));
      });
    }

    // Existing reports â†’ open PDF modal
    qsa('[data-report]').forEach(btn=> btn.addEventListener('click', ()=>{
      const type = btn.getAttribute('data-report');
      const url = buildPdfUrl(type);
      const frame = document.getElementById('pdfFrame');
      frame.src = url;
      openModal(document.getElementById('pdfModal'));
    }));

    // Flow navigation buttons
    qsa('.go').forEach(b=> b.addEventListener('click', e=>{
      const href = e.currentTarget.getAttribute('data-href');
      if(!href || e.currentTarget.disabled) return;
      
      // Update dependencies based on navigation
      if(href.includes('general_info')) state.deps.expertise = true;
      if(href.includes('upload-levi')) state.deps.levi = true;
      if(href.includes('damage-center')) state.deps.draft = true;
      
      applyDeps();
      window.location.href = href + paramCase();
    }));

    // Main CTA buttons
    if (qs('#cta-expertise')) {
      qs('#cta-expertise').addEventListener('click', ()=>{ 
        state.deps.expertise = true; 
        applyDeps(); 
        window.location.href = 'general_info.html' + paramCase(); 
      });
    }

    if (qs('#cta-exp-continue')) {
      qs('#cta-exp-continue').addEventListener('click', ()=>{ 
        window.location.href = 'expertise-summary.html' + paramCase(); 
      });
    }

    if (qs('#cta-estimate')) {
      qs('#cta-estimate').addEventListener('click', ()=> 
        window.location.href = 'estimate-builder.html' + paramCase()
      );
    }

    if (qs('#cta-est-continue')) {
      qs('#cta-est-continue').addEventListener('click', ()=> 
        window.location.href = 'estimate-report-builder.html' + paramCase()
      );
    }

    if (qs('#cta-final')) {
      qs('#cta-final').addEventListener('click', ()=> 
        window.location.href = 'final-report-builder.html' + paramCase()
      );
    }

    if (qs('#cta-final-continue')) {
      qs('#cta-final-continue').addEventListener('click', ()=> 
        window.location.href = 'final-report-template-builder.html' + paramCase()
      );
    }

    // Dev panel toggle (Alt+D)
    window.addEventListener('keydown', (e)=>{ 
      if(e.altKey && e.key.toLowerCase()==='d'){ 
        const p = qs('#devPanel'); 
        p.style.display = p.style.display==='none' ? 'block' : 'none'; 
      }
    });

    // Dev panel checkboxes
    qsa('#devPanel input[type=checkbox]').forEach(cb=> cb.addEventListener('change', ()=>{
      state.deps.expertise = qs('#dep-expertise')?.checked || false;
      state.deps.draft     = qs('#dep-draft')?.checked || false;
      state.deps.estimate  = qs('#dep-estimate')?.checked || false;
      state.deps.invoice   = qs('#dep-invoice')?.checked || false;
      state.deps.levi      = qs('#dep-levi')?.checked || false;
      applyDeps();
    }));

    // Initialize
    initCollapsibles();

    // Prefill date today
    if (qs('#date')) {
      qs('#date').value = new Date().toISOString().slice(0,10);
    }

    // URL parameters
    const qsParams = new URLSearchParams(location.search);
    if(qsParams.get('plate')){
      if (qs('#plate')) qs('#plate').value = qsParams.get('plate');
      if (qs('#owner')) qs('#owner').value = qsParams.get('owner')||'';
      if (qs('#date')) qs('#date').value = qsParams.get('date') || new Date().toISOString().slice(0,10);
      if (qs('#location')) qs('#location').value = qsParams.get('location')||'';
      startOrLoadCase();
    }

    // Initial state
    fillRibbon();
    applyDeps();

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'n': // Ctrl+N for new case
            e.preventDefault();
            qs('#plate').focus();
            break;
          case 's': // Ctrl+S for start case
            e.preventDefault();
            startOrLoadCase();
            break;
        }
      }
    });

    console.log('âœ… Yaron Kayouf Selection Portal initialized');
  }
  </script>
</body>
</html>