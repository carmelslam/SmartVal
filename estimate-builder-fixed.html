<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×•× ×” ××•××“×Ÿ - SmartVal</title>
    <link rel="stylesheet" href="global-styles.css">
    <script src="global-scripts.js"></script>
    <script src="legal-text-engine.js"></script>
    <style>
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e40af;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #1e40af;
            margin: 0;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #374151;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .btn {
            background: #1e40af;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #1e3a8a;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .floating-screens {
            position: fixed;
            top: 60px;
            left: 10px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .floating-btn {
            background: #1e40af;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Floating Action Buttons -->
    <div class="floating-screens">
        <button class="floating-btn" onclick="showBrowserMenuUnderToggle()" title="×“×¤×“×¤×Ÿ ×¤× ×™××™">ğŸŒ</button>
        <button class="floating-btn" onclick="toggleSection('summary')" title="×”×¦×’/×”×¡×ª×¨ ×¡×™×›×•×">ğŸ“Š</button>
        <button class="floating-btn" onclick="toggleSection('attachments')" title="×”×¦×’/×”×¡×ª×¨ ×§×‘×¦×™× ××¦×•×¨×¤×™×">ğŸ“</button>
        <button class="floating-btn" onclick="saveToHelper()" title="×©××•×¨ × ×ª×•× ×™×">ğŸ’¾</button>
    </div>

    <div class="main-container">
        <h1 style="text-align: center; color: #1e40af; margin-bottom: 30px;">×‘×•× ×” ××•××“×Ÿ ×¨×›×‘ - SmartVal</h1>
        
        <!-- Car Details Section -->
        <div class="section" id="carDetailsSection">
            <div class="section-header">
                <h2 class="section-title">×¤×¨×˜×™ ×”×¨×›×‘</h2>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="carPlate">××¡×¤×¨ ×¨×›×‘:</label>
                    <input type="text" id="carPlate" placeholder="××¡×¤×¨ ×¨×›×‘">
                </div>
                <div class="form-group">
                    <label for="carManufacturer">×™×¦×¨×Ÿ:</label>
                    <input type="text" id="carManufacturer" placeholder="×™×¦×¨×Ÿ ×”×¨×›×‘">
                </div>
                <div class="form-group">
                    <label for="carModel">×“×’×:</label>
                    <input type="text" id="carModel" placeholder="×“×’× ×”×¨×›×‘">
                </div>
                <div class="form-group">
                    <label for="carYear">×©× ×ª ×™×¦×•×¨:</label>
                    <input type="number" id="carYear" placeholder="×©× ×ª ×™×¦×•×¨">
                </div>
                <div class="form-group">
                    <label for="carModelCode">×§×•×“ ×“×’×:</label>
                    <input type="text" id="carModelCode" placeholder="×§×•×“ ×“×’×">
                </div>
                <div class="form-group">
                    <label for="carMileage">×§×™×œ×•××˜×¨××–':</label>
                    <input type="number" id="carMileage" placeholder="×§×™×œ×•××˜×¨××–'">
                </div>
                <div class="form-group">
                    <label for="carBasePrice">××—×™×¨ ×‘×¡×™×¡ (â‚ª):</label>
                    <input type="number" id="carBasePrice" placeholder="××—×™×¨ ×‘×¡×™×¡">
                </div>
                <div class="form-group">
                    <label for="carMarketValue">×©×•×•×™ ×©×•×§ (â‚ª):</label>
                    <input type="number" id="carMarketValue" placeholder="×©×•×•×™ ×©×•×§">
                </div>
                <div class="form-group">
                    <label for="carReportDate">×ª××¨×™×š ×“×•×—:</label>
                    <input type="date" id="carReportDate">
                </div>
            </div>
        </div>


        <!-- Summary Section -->
        <div class="section" id="summary" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">×¡×™×›×•× ×”×¢×¨×›×ª × ×–×§</h2>
            </div>
            <div id="summaryContent">
                <!-- Summary calculations will appear here -->
            </div>
        </div>

        <!-- Attachments Section -->
        <div class="section" id="attachments" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">×§×‘×¦×™× ××¦×•×¨×¤×™×</h2>
            </div>
            <div id="attachmentsContent">
                <!-- Attachments will appear here -->
            </div>
        </div>
    </div>

    <script>
    // State management
    const EstimateBuilderState = {
        hasChanges: false,
        currentHelper: null,
        damageCenters: []
    };

    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Authentication check
        const auth = sessionStorage.getItem("auth");
        if (!auth) {
            alert("×”×’×™×©×” ×—×¡×•××” - ×× × ×”×ª×—×‘×¨ ×“×¨×š ×“×£ ×”×‘×™×ª");
            window.location.href = "index.html";
        }

        // Initialize helper
        if (!window.helper || Object.keys(window.helper).length === 0) {
            window.helper = JSON.parse(sessionStorage.getItem('helper') || '{}');
        }

        // Load existing data
        loadHelperData();
    });

    // Load helper data into form fields
    function loadHelperData() {
        const helper = window.helper || {};
        
        // Load car details
        if (helper.car_data) {
            const fields = {
                'carPlate': helper.car_data.license_plate,
                'carManufacturer': helper.car_data.manufacturer,
                'carModel': helper.car_data.model,
                'carYear': helper.car_data.year,
                'carModelCode': helper.car_data.model_code,
                'carMileage': helper.car_data.mileage,
                'carBasePrice': helper.car_data.base_price,
                'carMarketValue': helper.car_data.market_value,
                'carReportDate': helper.car_data.report_date
            };

            Object.keys(fields).forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element && fields[fieldId]) {
                    element.value = fields[fieldId];
                }
            });
        }
    }


    // Toggle section visibility
    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
            const isVisible = section.style.display !== 'none';
            section.style.display = isVisible ? 'none' : 'block';
        }
    }

    // Custom browser menu
    function showBrowserMenuUnderToggle() {
        const menu = document.createElement('div');
        menu.style.cssText = `
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            z-index: 99999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            font-family: sans-serif;
            direction: rtl;
            min-width: 280px;
        `;
        
        menu.innerHTML = `
            <div style="font-weight: bold; margin-bottom: 15px; color: #2c3e50; font-size: 16px;">×‘×—×¨ ××ª×¨ ×œ×¤×ª×™×—×”:</div>
            <button onclick="window.openInternalBrowser('car-part.co.il'); this.parentElement.remove();" style="width: 100%; padding: 12px; margin-bottom: 8px; border: none; background: #28a745; color: white; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 500;">
                ğŸ”§ Car Part - ×—×œ×§×™ ×¨×›×‘
            </button>
            <button onclick="window.openInternalBrowser('portal.levi-itzhak.co.il'); this.parentElement.remove();" style="width: 100%; padding: 12px; margin-bottom: 8px; border: none; background: #007bff; color: white; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 500;">
                ğŸ“Š ×¤×•×¨×˜×œ ×œ×•×™ ×™×¦×—×§
            </button>
            <button onclick="this.parentElement.remove();" style="width: 100%; padding: 10px; border: 1px solid #ccc; background: white; color: #666; border-radius: 6px; cursor: pointer; font-size: 14px;">
                ×‘×™×˜×•×œ
            </button>
        `;
        
        document.body.appendChild(menu);
        
        // Remove menu when clicking outside
        setTimeout(() => {
            document.addEventListener('click', function removeMenu(e) {
                if (!menu.contains(e.target)) {
                    menu.remove();
                    document.removeEventListener('click', removeMenu);
                }
            });
        }, 100);
    }

    // Save to helper (placeholder)
    function saveToHelper() {
        // Implementation will be added
        alert('×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”');
    }

    </script>
</body>
</html>