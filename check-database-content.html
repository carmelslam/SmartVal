<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Content Check</title>
    <style>
        body { font-family: Arial; margin: 20px; direction: rtl; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>×‘×“×™×§×ª ×ª×•×›×Ÿ ×××’×¨ ×”× ×ª×•× ×™×</h1>

    <div>
        <button onclick="checkCatalogItems()">×‘×“×•×§ catalog_items</button>
        <button onclick="checkPartsBank()">×‘×“×•×§ PARTS_BANK</button>
        <button onclick="compareDataSources()">×”×©×•×•×” ××§×•×¨×•×ª × ×ª×•× ×™×</button>
    </div>

    <div id="results" class="result"></div>

    <script src="./services/supabaseClient.js"></script>
    <script src="./parts.js"></script>

    <script>
        const results = document.getElementById('results');

        async function checkCatalogItems() {
            results.innerHTML = '×‘×•×“×§ catalog_items...';
            
            try {
                // Check if table exists and has data
                const { data, error } = await window.supabase
                    .from('catalog_items')
                    .select('*')
                    .limit(5);
                
                if (error) {
                    results.innerHTML = `âŒ ×©×’×™××” ×‘×˜×‘×œ×ª catalog_items:\n${error.message}\n${JSON.stringify(error, null, 2)}`;
                    return;
                }
                
                if (!data || data.length === 0) {
                    results.innerHTML = `âš ï¸ ×˜×‘×œ×ª catalog_items ×¨×™×§×”!\n\n×”×˜×‘×œ×” ×§×™×™××ª ××‘×œ ××™×Ÿ ×‘×” × ×ª×•× ×™×.`;
                    return;
                }
                
                let report = `âœ… × ××¦××• ${data.length} ×¨×©×•××•×ª ×‘×˜×‘×œ×ª catalog_items:\n\n`;
                
                // Show table structure
                if (data[0]) {
                    report += `ğŸ—ï¸ ××‘× ×” ×”×˜×‘×œ×”:\n`;
                    Object.keys(data[0]).forEach(key => {
                        const value = data[0][key];
                        const type = typeof value;
                        report += `  ${key}: ${type} = "${value}"\n`;
                    });
                    report += `\n`;
                }
                
                // Show sample data
                report += `ğŸ“‹ ×“×•×’×××•×ª × ×ª×•× ×™×:\n`;
                data.forEach((item, index) => {
                    report += `\n--- ×¨×©×•××” ${index + 1} ---\n`;
                    report += `ID: ${item.id}\n`;
                    report += `PCODE: ${item.pcode || '×œ× ×–××™×Ÿ'}\n`;
                    report += `×ª×™××•×¨: ${item.cat_num_desc || '×œ× ×–××™×Ÿ'}\n`;
                    report += `××©×¤×—×ª ×—×œ×§: ${item.part_family || '×œ× ×–××™×Ÿ'}\n`;
                    report += `×™×¦×¨×Ÿ: ${item.make || '×œ× ×–××™×Ÿ'}\n`;
                    report += `×“×’×: ${item.model || '×œ× ×–××™×Ÿ'}\n`;
                    report += `××—×™×¨: ${item.price || '×œ× ×–××™×Ÿ'}\n`;
                    report += `×¡×¤×§: ${item.supplier_name || '×œ× ×–××™×Ÿ'}\n`;
                });
                
                results.innerHTML = report;
                
            } catch (error) {
                results.innerHTML = `âŒ ×©×’×™××” ×›×œ×œ×™×ª:\n${error.message}\n${error.stack}`;
            }
        }

        function checkPartsBank() {
            results.innerHTML = '×‘×•×“×§ PARTS_BANK...';
            
            if (!window.PARTS_BANK) {
                results.innerHTML = `âŒ window.PARTS_BANK ×œ× ×§×™×™×!\n\n×™×™×ª×›×Ÿ ×©×§×•×‘×¥ parts.js ×œ× × ×˜×¢×Ÿ.`;
                return;
            }
            
            const categories = Object.keys(window.PARTS_BANK);
            let totalParts = 0;
            
            let report = `âœ… PARTS_BANK × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!\n\n`;
            report += `ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª:\n`;
            report += `  ×§×˜×’×•×¨×™×•×ª: ${categories.length}\n`;
            
            categories.forEach(category => {
                const parts = window.PARTS_BANK[category];
                totalParts += parts.length;
                report += `  "${category}": ${parts.length} ×—×œ×§×™×\n`;
            });
            
            report += `  ×¡×”"×› ×—×œ×§×™×: ${totalParts}\n\n`;
            
            // Show first few categories as examples
            report += `ğŸ” ×“×•×’×××•×ª ×§×˜×’×•×¨×™×•×ª ×•×—×œ×§×™×:\n\n`;
            categories.slice(0, 3).forEach(category => {
                report += `"${category}":\n`;
                const parts = window.PARTS_BANK[category];
                parts.slice(0, 5).forEach(part => {
                    report += `  - ${part}\n`;
                });
                if (parts.length > 5) {
                    report += `  ... ×•×¢×•×“ ${parts.length - 5} ×—×œ×§×™×\n`;
                }
                report += `\n`;
            });
            
            results.innerHTML = report;
        }

        async function compareDataSources() {
            results.innerHTML = '××©×•×•×” ××§×•×¨×•×ª × ×ª×•× ×™×...';
            
            let report = `ğŸ“Š ×”×©×•×•××ª ××§×•×¨×•×ª × ×ª×•× ×™×:\n\n`;
            
            // Check PARTS_BANK
            const partsBank = window.PARTS_BANK;
            if (partsBank) {
                const categories = Object.keys(partsBank);
                let totalParts = 0;
                categories.forEach(cat => totalParts += partsBank[cat].length);
                
                report += `ğŸ¦ PARTS_BANK (× ×ª×•× ×™× ××§×•××™×™×):\n`;
                report += `  âœ… ×–××™×Ÿ\n`;
                report += `  ğŸ“ˆ ${categories.length} ×§×˜×’×•×¨×™×•×ª\n`;
                report += `  ğŸ”¢ ${totalParts} ×—×œ×§×™× ×‘×¡×š ×”×›×œ\n`;
                report += `  ğŸ¯ ××§×•×¨: ×§×•×‘×¥ parts.js\n`;
                report += `  ğŸ”¤ ×©×¤×”: ×¢×‘×¨×™×ª\n\n`;
            } else {
                report += `ğŸ¦ PARTS_BANK:\n  âŒ ×œ× ×–××™×Ÿ\n\n`;
            }
            
            // Check catalog_items
            try {
                const { data, error } = await window.supabase
                    .from('catalog_items')
                    .select('*')
                    .limit(10);
                
                if (error) {
                    report += `ğŸ—„ï¸ catalog_items (×××’×¨ × ×ª×•× ×™×):\n`;
                    report += `  âŒ ×©×’×™××”: ${error.message}\n\n`;
                } else if (!data || data.length === 0) {
                    report += `ğŸ—„ï¸ catalog_items (×××’×¨ × ×ª×•× ×™×):\n`;
                    report += `  âš ï¸ ×˜×‘×œ×” ×¨×™×§×”\n`;
                    report += `  ğŸ¯ ××§×•×¨: Supabase\n`;
                    report += `  ğŸ“Š 0 ×¨×©×•××•×ª\n\n`;
                } else {
                    // Analyze content
                    const sampleItem = data[0];
                    const hasHebrew = Object.values(sampleItem).some(val => 
                        val && typeof val === 'string' && /[\\u0590-\\u05FF]/.test(val)
                    );
                    
                    report += `ğŸ—„ï¸ catalog_items (×××’×¨ × ×ª×•× ×™×):\n`;
                    report += `  âœ… ×–××™×Ÿ\n`;
                    report += `  ğŸ“Š ${data.length}+ ×¨×©×•××•×ª\n`;
                    report += `  ğŸ¯ ××§×•×¨: Supabase\n`;
                    report += `  ğŸ”¤ ×©×¤×”: ${hasHebrew ? '×¢×‘×¨×™×ª + ×× ×’×œ×™×ª' : '×× ×’×œ×™×ª'}\n`;
                    report += `  ğŸ—ï¸ ×¢××•×“×•×ª: ${Object.keys(sampleItem).join(', ')}\n\n`;
                }
            } catch (error) {
                report += `ğŸ—„ï¸ catalog_items:\n  âŒ ×©×’×™××” ×‘×’×™×©×”: ${error.message}\n\n`;
            }
            
            // Conclusion
            report += `ğŸ’¡ ××¡×§× ×•×ª:\n`;
            if (partsBank && (!window.supabase || totalParts > 0)) {
                report += `  ğŸ¯ ×”××¢×¨×›×ª ×›×¨×’×¢ ××©×ª××©×ª ×‘-PARTS_BANK ×”××§×•××™\n`;
                report += `  ğŸ”„ ×”×—×™×¤×•×© ×”××ª×§×“× ×¢×•×‘×“ ×¢× ×”× ×ª×•× ×™× ×”××§×•××™×™×\n`;
                report += `  âš ï¸ ×”×—×™×¤×•×© ×”×—×•×¤×©×™ ×× ×¡×” ×œ×—×¤×© ×‘-catalog_items\n`;
                report += `  ğŸ”§ ×“×¨×•×© ×ª×™××•× ×‘×™×Ÿ ×©× ×™ ××§×•×¨×•×ª ×”× ×ª×•× ×™×\n`;
            }
            
            results.innerHTML = report;
        }
    </script>
</body>
</html>