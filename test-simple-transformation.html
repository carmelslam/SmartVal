<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test Simple Transformation (No Logo)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      direction: rtl;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    input[type="text"] {
      width: 90%;
      padding: 8px;
      margin: 5px 0;
      direction: ltr;
    }
    button {
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      direction: ltr;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
    }
    img {
      max-width: 100%;
      margin-top: 10px;
      border: 2px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>×‘×“×™×§×ª ×˜×¨× ×¡×¤×•×¨××¦×™×” ×¤×©×•×˜×” (×œ×œ× ×œ×•×’×•)</h1>

  <div class="test-section">
    <h3>Test 1: ×‘×“×™×§×” ×‘×¡×™×¡×™×ª - ×¨×§ ×©×™× ×•×™ ×’×•×“×œ</h3>
    <p>×‘×“×™×§×” ×–×• ×ª×™×¦×•×¨ URL ×¤×©×•×˜ ×œ×œ× ×œ×•×’×• ××• ×˜×§×¡×˜</p>
    <label>Supabase Image URL:</label>
    <input type="text" id="test1Url" value="https://nvqrptokmwdhvpiufrad.supabase.co/storage/v1/object/public/originals/case-c52af5d6-3b78-47b8-88a2-d2553ee3e1af/damage/20251121_152321_10B46889-5D09-4593-B544-801735454E96_1_105_c.jpeg">
    <button onclick="testBasicTransformation()">×‘×“×•×§ ×˜×¨× ×¡×¤×•×¨××¦×™×” ×‘×¡×™×¡×™×ª</button>
    <div id="test1Result"></div>
  </div>

  <div class="test-section">
    <h3>Test 2: ×¢× ×˜×§×¡×˜ ××‘×œ ×œ×œ× ×œ×•×’×•</h3>
    <p>×‘×“×™×§×” ×–×• ×ª×™×¦×•×¨ URL ×¢× ×›×œ ×”×©×“×•×ª ××œ×‘×“ ×”×œ×•×’×•</p>
    <label>Supabase Image URL:</label>
    <input type="text" id="test2Url" value="https://nvqrptokmwdhvpiufrad.supabase.co/storage/v1/object/public/originals/case-c52af5d6-3b78-47b8-88a2-d2553ee3e1af/damage/20251121_152321_10B46889-5D09-4593-B544-801735454E96_1_105_c.jpeg">
    <label>××¡×¤×¨ ×œ×•×—×™×ª:</label>
    <input type="text" id="test2Plate" value="22-184-00">
    <button onclick="testTransformationNoLogo()">×‘×“×•×§ ×¢× ×˜×§×¡×˜ ×œ×œ× ×œ×•×’×•</button>
    <div id="test2Result"></div>
  </div>

  <div class="test-section">
    <h3>Test 3: ×‘×“×™×§×ª ×’×™×©×” ×œ×ª××•× ×” ×‘-Supabase</h3>
    <p>×‘×“×™×§×” ×× ×”×ª××•× ×” × ×’×™×©×” ×™×©×™×¨×•×ª ×-Supabase (×œ×œ× Cloudinary)</p>
    <label>Supabase Image URL:</label>
    <input type="text" id="test3Url" value="https://nvqrptokmwdhvpiufrad.supabase.co/storage/v1/object/public/originals/case-c52af5d6-3b78-47b8-88a2-d2553ee3e1af/damage/20251121_152321_10B46889-5D09-4593-B544-801735454E96_1_105_c.jpeg">
    <button onclick="testSupabaseAccess()">×‘×“×•×§ ×’×™×©×” ×œ-Supabase</button>
    <div id="test3Result"></div>
  </div>

  <script>
    const CLOUDINARY_CONFIG = {
      cloudName: 'dwl9x9acl',
      fetchBaseUrl: 'https://res.cloudinary.com/dwl9x9acl/image/fetch/'
    };

    function encodeHebrewForCloudinary(text) {
      if (!text) return '';
      const encoded = encodeURIComponent(text);
      return encodeURIComponent(encoded);
    }

    // Test 1: Basic transformation (resize only, no overlays)
    function testBasicTransformation() {
      const supabaseUrl = document.getElementById('test1Url').value;
      const resultDiv = document.getElementById('test1Result');

      if (!supabaseUrl) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '× × ×œ×”×–×™×Ÿ URL ×©×œ ×ª××•× ×”';
        return;
      }

      try {
        // Simple transformation: just resize and format
        const transformations = 'w_800,h_600,c_fit,q_auto:good,f_jpg';
        const encodedSourceUrl = encodeURIComponent(supabaseUrl);
        const cloudinaryUrl = `${CLOUDINARY_CONFIG.fetchBaseUrl}${transformations}/${encodedSourceUrl}`;

        resultDiv.className = 'result success';
        resultDiv.innerHTML = `
âœ… URL × ×•×¦×¨ ×‘×”×¦×œ×—×”!

Cloudinary Fetch URL:
${cloudinaryUrl}

××•×¨×š URL: ${cloudinaryUrl.length}

×˜×¨× ×¡×¤×•×¨××¦×™×•×ª:
- Width: 800px
- Height: 600px
- Crop: fit
- Quality: auto:good
- Format: jpg

<a href="${cloudinaryUrl}" target="_blank" style="color: blue;">ğŸ”— ×¤×ª×— ×‘×˜××‘ ×—×“×©</a>

<img src="${cloudinaryUrl}" alt="Transformed Image" onerror="this.style.border='3px solid red'; this.alt='âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª××•× ×”'">
        `;

        console.log('âœ… Test 1 - Basic transformation URL:', cloudinaryUrl);
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `âŒ ×©×’×™××”: ${error.message}`;
        console.error('âŒ Test 1 error:', error);
      }
    }

    // Test 2: Full transformation WITHOUT logo layer
    function testTransformationNoLogo() {
      const supabaseUrl = document.getElementById('test2Url').value;
      const plate = document.getElementById('test2Plate').value;
      const resultDiv = document.getElementById('test2Result');

      if (!supabaseUrl) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '× × ×œ×”×–×™×Ÿ URL ×©×œ ×ª××•× ×”';
        return;
      }

      try {
        // Hebrew labels
        const nameLabel = '×™×¨×•×Ÿ ×›×™×•×£ - ×©×××•×ª ×•×™×™×¢×•×¥';
        const licenceLabel = '×¨×©×™×•×Ÿ ××¡×¤×¨ 1097';
        const plateLabel = '×œ×•×—×™×ª ×¨×™×©×•×™';

        // Encode Hebrew text
        const encodedName = encodeHebrewForCloudinary(nameLabel);
        const encodedLicence = encodeHebrewForCloudinary(licenceLabel);
        const encodedPlateLabel = encodeHebrewForCloudinary(plateLabel);
        const encodedPlate = encodeURIComponent(plate);

        // Build transformations WITHOUT logo layer
        const transformations = [
          // Base transformations
          'c_pad,w_850,h_750,g_north,b_ivory,q_auto:good,f_jpg',

          // âŒ SKIPPED: Logo overlay (commented out to test without logo)
          // 'l_yaronlogo_trans_u7vuyt,w_130',
          // 'fl_layer_apply,g_south_west,x_30,y_0',

          // Business name (top text - navy blue)
          `co_rgb:000080,l_text:Palatino_22_bold_italic_left:${encodedName}`,
          'fl_layer_apply,g_south_east,x_30,y_90',

          // Business license (navy blue)
          `co_rgb:000080,l_text:Palatino_20_italic_left:${encodedLicence}`,
          'fl_layer_apply,g_south_east,x_30,y_70',

          // Plate label + actual plate number (red)
          `co_rgb:ff0000,l_text:palatino_20_italic_left:${encodedPlateLabel}${encodedPlate ? '%3A%20' + encodedPlate : ''}`,
          'fl_layer_apply,g_south_east,x_30,y_50'
        ].join('/');

        const encodedSourceUrl = encodeURIComponent(supabaseUrl);
        const cloudinaryUrl = `${CLOUDINARY_CONFIG.fetchBaseUrl}${transformations}/${encodedSourceUrl}`;

        resultDiv.className = 'result success';
        resultDiv.innerHTML = `
âœ… URL × ×•×¦×¨ ×‘×”×¦×œ×—×” (×œ×œ× ×œ×•×’×•)!

Cloudinary Fetch URL:
${cloudinaryUrl}

××•×¨×š URL: ${cloudinaryUrl.length}

×˜×¨× ×¡×¤×•×¨××¦×™×•×ª:
âœ… Base: c_pad,w_850,h_750,b_ivory
âŒ Logo: SKIPPED (testing without logo)
âœ… Business name: ${nameLabel}
âœ… License: ${licenceLabel}
âœ… Plate: ${plateLabel}: ${plate}

<a href="${cloudinaryUrl}" target="_blank" style="color: blue;">ğŸ”— ×¤×ª×— ×‘×˜××‘ ×—×“×©</a>

<img src="${cloudinaryUrl}" alt="Transformed Image (No Logo)" onerror="this.style.border='3px solid red'; this.alt='âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª××•× ×”'">
        `;

        console.log('âœ… Test 2 - Transformation without logo URL:', cloudinaryUrl);
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `âŒ ×©×’×™××”: ${error.message}`;
        console.error('âŒ Test 2 error:', error);
      }
    }

    // Test 3: Direct Supabase access (no Cloudinary)
    async function testSupabaseAccess() {
      const supabaseUrl = document.getElementById('test3Url').value;
      const resultDiv = document.getElementById('test3Result');

      if (!supabaseUrl) {
        resultDiv.className = 'result error';
        resultDiv.textContent = '× × ×œ×”×–×™×Ÿ URL ×©×œ ×ª××•× ×”';
        return;
      }

      resultDiv.className = 'result';
      resultDiv.textContent = '×‘×•×“×§ ×’×™×©×” ×œ-Supabase...';

      try {
        const response = await fetch(supabaseUrl, { method: 'HEAD' });

        if (response.ok) {
          const contentType = response.headers.get('content-type');
          const contentLength = response.headers.get('content-length');

          resultDiv.className = 'result success';
          resultDiv.innerHTML = `
âœ… ×”×ª××•× ×” × ×’×™×©×” ×‘-Supabase!

Supabase URL:
${supabaseUrl}

Response:
- Status: ${response.status} ${response.statusText}
- Content-Type: ${contentType}
- Content-Length: ${contentLength ? (contentLength / 1024).toFixed(2) + ' KB' : 'Unknown'}

×–×” ××•××¨ ×©×”-bucket public ×•-Cloudinary ×××•×¨ ×œ×”×¦×œ×™×— ×œ×§×¨×•× ××ª ×”×ª××•× ×”.

<a href="${supabaseUrl}" target="_blank" style="color: blue;">ğŸ”— ×¤×ª×— ×‘×˜××‘ ×—×“×©</a>

<img src="${supabaseUrl}" alt="Original Supabase Image" onerror="this.style.border='3px solid red'; this.alt='âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª××•× ×”'">
          `;

          console.log('âœ… Test 3 - Supabase access OK:', response);
        } else {
          resultDiv.className = 'result error';
          resultDiv.innerHTML = `
âŒ ×©×’×™××” ×‘×’×™×©×” ×œ-Supabase!

Status: ${response.status} ${response.statusText}

×–×” ××•××¨ ×©×”-bucket ××™× ×• public ××• ×©×”× ×ª×™×‘ ×©×’×•×™.
          `;

          console.error('âŒ Test 3 - Supabase access failed:', response);
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.textContent = `âŒ ×©×’×™××”: ${error.message}`;
        console.error('âŒ Test 3 error:', error);
      }
    }
  </script>
</body>
</html>
