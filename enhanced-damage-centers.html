<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××•×§×“×™ × ×–×§ ××ª×§×“××™× - ×™×¨×•×Ÿ ×›×™×•×£ ×©×××•×ª</title>
  <link rel="icon" type="image/webp" href="https://carmelcayouf.com/wp-content/uploads/2025/06/g.webp">
  <link rel="shortcut icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp">
  <link rel="apple-touch-icon" href="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      direction: rtl;
    }
    
    .page-container {
      min-height: 100vh;
      padding: 20px;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      flex-direction: column;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #ff6b6b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 18px;
      color: #333;
      font-weight: bold;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .logo {
      width: 100px;
      height: auto;
      margin-bottom: 15px;
    }
    
    .header h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #666;
      font-size: 16px;
    }
    
    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin: 20px auto;
      max-width: 600px;
      border: 1px solid #f5c6cb;
    }
    
    .retry-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
      font-size: 14px;
    }
    
    .retry-btn:hover {
      background: #c82333;
    }
    
    .navigation {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 15px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      gap: 15px;
      z-index: 1000;
    }
    
    .nav-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }
    
    .nav-btn.primary {
      background: #007bff;
      color: white;
    }
    
    .nav-btn.secondary {
      background: #6c757d;
      color: white;
    }
    
    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    #app {
      /* Styles will be provided by the enhanced-damage-centers.js module */
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .page-container {
        padding: 10px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .navigation {
        bottom: 10px;
        left: 10px;
        right: 10px;
        transform: none;
        justify-content: space-between;
      }
      
      .nav-btn {
        flex: 1;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-spinner"></div>
      <div class="loading-text">×˜×•×¢×Ÿ ××•×“×•×œ ××•×§×“×™ × ×–×§ ××ª×§×“×...</div>
    </div>

    <!-- Header -->
    <div class="header">
      <img src="https://carmelcayouf.com/wp-content/uploads/2025/04/logo-yaron.webp" alt="×™×¨×•×Ÿ ×›×™×•×£ ×©×××•×ª" class="logo">
      <h1>ğŸ§± ××•×§×“×™ × ×–×§ ××ª×§×“××™×</h1>
      <p>× ×™×”×•×œ ××§×¦×•×¢×™ ×•××ª×§×“× ×©×œ ××•×§×“×™ × ×–×§ ×‘×¨×›×‘</p>
    </div>

    <!-- Main application container -->
    <div id="app">
      <!-- Content will be rendered by enhanced-damage-centers.js -->
    </div>

    <!-- Error fallback -->
    <div id="error-container" style="display: none;">
      <div class="error-message">
        <h3>âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××•×“×•×œ</h3>
        <p>××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ××•×“×•×œ ××•×§×“×™ ×”× ×–×§ ×”××ª×§×“×.</p>
        <p>×× × ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×” ×©×•×‘.</p>
        <button class="retry-btn" onclick="location.reload()">× ×¡×” ×©×•×‘</button>
        <button class="retry-btn" onclick="window.location.href='damage-center-flow.html'" style="background: #6c757d; margin-right: 10px;">
          ×—×–×•×¨ ×œ××•×“×•×œ ×”×‘×¡×™×¡×™
        </button>
      </div>
    </div>

    <!-- Navigation -->
    <div class="navigation">
      <a href="selection.html" class="nav-btn secondary">ğŸ  ×¢××•×“ ×”×‘×™×ª</a>
      <a href="car-details.html" class="nav-btn secondary">ğŸš— ×¤×¨×˜×™ ×¨×›×‘</a>
      <a href="upload-images.html" class="nav-btn primary">ğŸ“¸ ×”×¢×œ××ª ×ª××•× ×•×ª</a>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module">
    // Enhanced error handling and module loading
    let moduleLoaded = false;
    let loadTimeout;

    // Set loading timeout
    loadTimeout = setTimeout(() => {
      if (!moduleLoaded) {
        showError('×˜×¢×™× ×ª ×”××•×“×•×œ × ×›×©×œ×” - ×ª× ×”×–××Ÿ ×”×§×¦×•×‘');
      }
    }, 10000); // 10 second timeout

    function showError(message) {
      console.error('Module loading error:', message);
      document.getElementById('loading-overlay').style.display = 'none';
      document.getElementById('error-container').style.display = 'block';
    }

    function hideLoading() {
      moduleLoaded = true;
      clearTimeout(loadTimeout);
      document.getElementById('loading-overlay').style.display = 'none';
    }

    // Authentication check
    const auth = sessionStorage.getItem("auth");
    if (!auth) {
      alert("×”×’×™×©×” ×—×¡×•××” - ×× × ×”×ª×—×‘×¨ ×“×¨×š ×“×£ ×”×‘×™×ª");
      window.location.href = "index.html";
    }

    // Load the enhanced damage centers module
    try {
      import('./enhanced-damage-centers.js')
        .then(module => {
          console.log('âœ… Enhanced damage centers module loaded successfully');
          hideLoading();
          
          // Initialize keyboard shortcuts info
          setTimeout(() => {
            console.log('ğŸ”§ Enhanced Damage Centers - Keyboard shortcuts:');
            console.log('Ctrl+S: Save as draft');
            console.log('Ctrl+â†/â†’: Navigate between centers');
            console.log('Auto-save: Every 30 seconds');
          }, 1000);
        })
        .catch(error => {
          console.error('Error loading enhanced damage centers module:', error);
          
          // Fallback to basic module
          console.log('ğŸ”„ Attempting to load basic damage center module...');
          return import('./DAMAGE CENTER MODULE.js');
        })
        .then(fallbackModule => {
          if (fallbackModule) {
            console.log('âœ… Basic damage center module loaded as fallback');
            hideLoading();
            
            // Initialize basic module
            if (fallbackModule.damageCenters) {
              fallbackModule.damageCenters();
            }
          }
        })
        .catch(fallbackError => {
          console.error('Both enhanced and basic modules failed to load:', fallbackError);
          showError('×©× ×™ ×”××•×“×•×œ×™× (××ª×§×“× ×•×‘×¡×™×¡×™) × ×›×©×œ×• ×‘×˜×¢×™× ×”');
        });
    } catch (importError) {
      console.error('Import not supported, falling back to basic module');
      showError('×”×“×¤×“×¤×Ÿ ××™× ×• ×ª×•××š ×‘×˜×¢×™× ×ª ××•×“×•×œ×™× ××ª×§×“××™×');
    }

    // Global error handler
    window.addEventListener('error', (event) => {
      console.error('Global error:', event.error);
      if (!moduleLoaded) {
        showError('×©×’×™××” ×›×œ×œ×™×ª ×‘×˜×¢×™× ×ª ×”×¢××•×“');
      }
    });

    // Unload handler for unsaved changes
    window.addEventListener('beforeunload', (event) => {
      if (window.damageCentersModule && window.damageCentersModule.unsavedChanges) {
        event.preventDefault();
        event.returnValue = '×™×© ×©×™× ×•×™×™× ×©×œ× × ×©××¨×•. ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¢×–×•×‘?';
        return event.returnValue;
      }
    });

    // Session timeout handling
    let sessionTimeout = setTimeout(() => {
      alert('×”×¤×’×™×©×” ×¤×’×”. ×× × ×”×ª×—×‘×¨ ××—×“×©.');
      sessionStorage.clear();
      window.location.href = 'index.html';
    }, 30 * 60 * 1000); // 30 minutes

    // Reset session timeout on activity
    document.addEventListener('click', () => {
      clearTimeout(sessionTimeout);
      sessionTimeout = setTimeout(() => {
        alert('×”×¤×’×™×©×” ×¤×’×”. ×× × ×”×ª×—×‘×¨ ××—×“×©.');
        sessionStorage.clear();
        window.location.href = 'index.html';
      }, 30 * 60 * 1000);
    });
  </script>

  <!-- Fallback script for browsers that don't support modules -->
  <script nomodule>
    console.warn('Browser does not support ES modules, loading basic version');
    
    // Hide loading and show error with fallback option
    document.getElementById('loading-overlay').style.display = 'none';
    document.getElementById('error-container').innerHTML = `
      <div class="error-message">
        <h3>ğŸ”„ ××¢×‘×¨ ×œ××•×“×•×œ ×‘×¡×™×¡×™</h3>
        <p>×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘×’×¨×¡×” ×”××ª×§×“××ª.</p>
        <p>××¢×‘×™×¨ ××•×ª×š ×œ××•×“×•×œ ×”×‘×¡×™×¡×™...</p>
      </div>
    `;
    document.getElementById('error-container').style.display = 'block';
    
    // Redirect to basic version after 3 seconds
    setTimeout(() => {
      window.location.href = 'damage-center-flow.html';
    }, 3000);
  </script>

  <!-- Analytics and monitoring (optional) -->
  <script>
    // Basic usage analytics
    if (typeof gtag !== 'undefined') {
      gtag('event', 'page_view', {
        page_title: 'Enhanced Damage Centers',
        page_location: window.location.href
      });
    }
    
    // Performance monitoring
    window.addEventListener('load', () => {
      const loadTime = performance.now();
      console.log(`ğŸ“Š Page loaded in ${loadTime.toFixed(2)}ms`);
      
      if (loadTime > 5000) {
        console.warn('âš ï¸ Slow page load detected');
      }
    });
  </script>
  <script src="fix-helper-data-flow.js"></script>
</body>
</html>