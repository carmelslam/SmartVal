<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SESSION 76: Test Supabase Initialization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>SESSION 76: Supabase Client Initialization Test</h1>
    <p>This page tests if window.supabase is properly initialized with all required properties.</p>
    
    <div id="results"></div>

    <script src="lib/supabaseClient.js"></script>
    <script>
        const results = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runTests() {
            console.log('üß™ SESSION 76: Starting Supabase client tests...');

            // Test 1: window.supabase exists
            if (window.supabase) {
                addResult('‚úÖ Test 1 PASSED: window.supabase exists', 'success');
            } else {
                addResult('‚ùå Test 1 FAILED: window.supabase does not exist', 'error');
                return;
            }

            // Test 2: supabase.from() exists
            if (typeof window.supabase.from === 'function') {
                addResult('‚úÖ Test 2 PASSED: supabase.from() method exists', 'success');
            } else {
                addResult('‚ùå Test 2 FAILED: supabase.from() method missing', 'error');
            }

            // Test 3: supabase.storage exists
            if (window.supabase.storage) {
                addResult('‚úÖ Test 3 PASSED: supabase.storage exists', 'success');
            } else {
                addResult('‚ùå Test 3 FAILED: supabase.storage missing', 'error');
            }

            // Test 4: supabase.auth exists (SESSION 76 addition)
            if (window.supabase.auth) {
                addResult('‚úÖ Test 4 PASSED: supabase.auth exists (SESSION 76)', 'success');
            } else {
                addResult('‚ùå Test 4 FAILED: supabase.auth missing', 'error');
            }

            // Test 5: supabase.auth.getSession exists
            if (window.supabase.auth && typeof window.supabase.auth.getSession === 'function') {
                addResult('‚úÖ Test 5 PASSED: supabase.auth.getSession() exists', 'success');
            } else {
                addResult('‚ùå Test 5 FAILED: supabase.auth.getSession() missing', 'error');
            }

            // Test 6: supabase.auth.getUser exists
            if (window.supabase.auth && typeof window.supabase.auth.getUser === 'function') {
                addResult('‚úÖ Test 6 PASSED: supabase.auth.getUser() exists', 'success');
            } else {
                addResult('‚ùå Test 6 FAILED: supabase.auth.getUser() missing', 'error');
            }

            // Test 7: supabase.storage.from() exists
            if (window.supabase.storage && typeof window.supabase.storage.from === 'function') {
                addResult('‚úÖ Test 7 PASSED: supabase.storage.from() exists', 'success');
            } else {
                addResult('‚ùå Test 7 FAILED: supabase.storage.from() missing', 'error');
            }

            // Test 8: supabase.rpc exists
            if (typeof window.supabase.rpc === 'function') {
                addResult('‚úÖ Test 8 PASSED: supabase.rpc() exists', 'success');
            } else {
                addResult('‚ùå Test 8 FAILED: supabase.rpc() missing', 'error');
            }

            // Summary
            const apiStructure = {
                'window.supabase': !!window.supabase,
                'from': typeof window.supabase?.from === 'function',
                'auth': !!window.supabase?.auth,
                'auth.getSession': typeof window.supabase?.auth?.getSession === 'function',
                'auth.getUser': typeof window.supabase?.auth?.getUser === 'function',
                'storage': !!window.supabase?.storage,
                'storage.from': typeof window.supabase?.storage?.from === 'function',
                'rpc': typeof window.supabase?.rpc === 'function',
                'channel': typeof window.supabase?.channel === 'function'
            };

            addResult(`<h3>API Structure:</h3><pre>${JSON.stringify(apiStructure, null, 2)}</pre>`, 'info');

            console.log('‚úÖ SESSION 76: All tests complete');
        }

        // Run tests after DOM loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>
