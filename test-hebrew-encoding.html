<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hebrew Encoding Test</title>
    <style>
        body { font-family: Arial; margin: 20px; direction: rtl; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>בדיקת קידוד עברית - Supabase</h1>

    <div class="test">
        <h3>1. בדיקת קידוד URL</h3>
        <button onclick="testEncoding()">בדוק קידוד</button>
        <div id="encoding-result" class="result"></div>
    </div>

    <div class="test">
        <h3>2. בדיקת REST API ישיר</h3>
        <button onclick="testDirectAPI()">בדוק API ישיר</button>
        <div id="api-result" class="result"></div>
    </div>

    <div class="test">
        <h3>3. בדיקת Custom Client</h3>
        <button onclick="testCustomClient()">בדוק Custom Client</button>
        <div id="client-result" class="result"></div>
    </div>

    <script src="./services/supabaseClient.js"></script>
    <script>
        const supabaseUrl = 'https://nvqrptokmwdhvpiufrad.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im52cXJwdG9rbXdkaHZwaXVmcmFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwMzU0ODUsImV4cCI6MjA3MTYxMTQ4NX0.yvFalmZE7Xpvo_j6wzRj44Pa7Bx9LQegcyLzbz3QL5s';

        function testEncoding() {
            const hebrewText = 'יוליק';
            const result = document.getElementById('encoding-result');
            
            result.innerHTML = `
Hebrew text: "${hebrewText}"
UTF-8 bytes: ${Array.from(new TextEncoder().encode(hebrewText)).map(b => b.toString(16)).join(' ')}
encodeURIComponent: ${encodeURIComponent(hebrewText)}
Manual encoding: ${encodeURIComponent(hebrewText).split('%').join('%25')}

English comparison:
Text: "VAG"
encodeURIComponent: ${encodeURIComponent('VAG')}
            `;
        }

        async function testDirectAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = 'Testing direct REST API...';

            try {
                // Test 1: Direct REST API call with Hebrew
                const hebrewTerm = 'יוליק';
                const encodedHebrew = encodeURIComponent(hebrewTerm);
                
                const url1 = `${supabaseUrl}/rest/v1/catalog_items?make=ilike.%25${encodedHebrew}%25&limit=3`;
                
                const response1 = await fetch(url1, {
                    headers: {
                        'apikey': supabaseAnonKey,
                        'Authorization': `Bearer ${supabaseAnonKey}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json; charset=utf-8'
                    }
                });

                const data1 = await response1.json();
                
                // Test 2: Direct REST API call with English
                const englishTerm = 'VAG';
                const url2 = `${supabaseUrl}/rest/v1/catalog_items?make=ilike.%25${englishTerm}%25&limit=3`;
                
                const response2 = await fetch(url2, {
                    headers: {
                        'apikey': supabaseAnonKey,
                        'Authorization': `Bearer ${supabaseAnonKey}`,
                        'Accept': 'application/json'
                    }
                });

                const data2 = await response2.json();

                result.innerHTML = `
Direct API Results:

Hebrew search "${hebrewTerm}":
URL: ${url1}
Status: ${response1.status}
Results: ${Array.isArray(data1) ? data1.length : 'Error'}
${!Array.isArray(data1) ? 'Error: ' + JSON.stringify(data1) : ''}

English search "${englishTerm}":
URL: ${url2}  
Status: ${response2.status}
Results: ${Array.isArray(data2) ? data2.length : 'Error'}
                `;

            } catch (error) {
                result.innerHTML = `Error: ${error.message}`;
            }
        }

        async function testCustomClient() {
            const result = document.getElementById('client-result');
            result.innerHTML = 'Testing custom client...';

            try {
                // Test Hebrew search
                const hebrewResult = await window.supabase
                    .from('catalog_items')
                    .select('*')
                    .ilike('make', '%יוליק%')
                    .limit(3);

                // Test English search
                const englishResult = await window.supabase
                    .from('catalog_items')
                    .select('*')
                    .ilike('make', '%VAG%')
                    .limit(3);

                result.innerHTML = `
Custom Client Results:

Hebrew search "יוליק":
Error: ${hebrewResult.error ? hebrewResult.error.message : 'None'}
Results: ${hebrewResult.data ? hebrewResult.data.length : 'None'}

English search "VAG":
Error: ${englishResult.error ? englishResult.error.message : 'None'}
Results: ${englishResult.data ? englishResult.data.length : 'None'}
                `;

            } catch (error) {
                result.innerHTML = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>