<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Catalog Data</title>
    <style>
        body { font-family: Arial; margin: 20px; direction: rtl; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>×‘×“×™×§×ª × ×ª×•× ×™ ×§×˜×œ×•×’ - Hebrew Parts</h1>

    <div>
        <button onclick="checkTotalItems()">×‘×“×•×§ ×¡×”"×› ×¤×¨×™×˜×™×</button>
        <button onclick="searchHebrewParts()">×—×¤×© ×—×œ×§×™× ×‘×¢×‘×¨×™×ª</button>
        <button onclick="searchEnglishParts()">×—×¤×© ×—×œ×§×™× ×‘×× ×’×œ×™×ª</button>
        <button onclick="getSampleData()">×“×•×’×××•×ª × ×ª×•× ×™×</button>
        <button onclick="testPiPWindow()">×‘×“×•×§ PiP</button>
    </div>

    <div id="results" class="result"></div>

    <script src="./services/supabaseClient.js"></script>
    <script src="./services/smartPartsSearchService.js"></script>
    <script src="./parts-search-results-pip.js"></script>

    <script>
        const results = document.getElementById('results');

        async function checkTotalItems() {
            results.innerHTML = '×‘×•×“×§ ×¡×”"×› ×¤×¨×™×˜×™×...';
            
            try {
                // Use a simple select with limit to estimate total items
                const { data, error } = await window.supabase
                    .from('catalog_items')
                    .select('id')
                    .limit(1000);
                
                if (error) {
                    results.innerHTML = `×©×’×™××”: ${error.message}`;
                    return;
                }
                
                if (data.length === 1000) {
                    results.innerHTML = `×™×© ×œ×¤×—×•×ª 1000+ ×¤×¨×™×˜×™× ×‘×§×˜×œ×•×’`;
                } else {
                    results.innerHTML = `×¡×”"×› ×¤×¨×™×˜×™× ×‘×§×˜×œ×•×’: ${data.length}`;
                }
                
            } catch (error) {
                results.innerHTML = `×©×’×™××”: ${error.message}`;
            }
        }

        async function getSampleData() {
            results.innerHTML = '××‘×™× ×“×•×’×××•×ª × ×ª×•× ×™×...';
            
            try {
                const { data, error } = await window.supabase
                    .from('catalog_items')
                    .select('*')
                    .limit(10);
                
                if (error) {
                    results.innerHTML = `×©×’×™××”: ${error.message}`;
                    return;
                }
                
                let html = `<h3>×“×•×’×××•×ª × ×ª×•× ×™× (${data.length} ×¤×¨×™×˜×™×):</h3><table>`;
                html += '<tr><th>ID</th><th>PCODE</th><th>×ª×™××•×¨</th><th>××©×¤×—×ª ×—×œ×§</th><th>×™×¦×¨×Ÿ</th><th>×“×’×</th></tr>';
                
                data.forEach(item => {
                    html += `<tr>
                        <td>${item.id}</td>
                        <td>${item.pcode || 'N/A'}</td>
                        <td>${item.cat_num_desc || 'N/A'}</td>
                        <td>${item.part_family || 'N/A'}</td>
                        <td>${item.make || 'N/A'}</td>
                        <td>${item.model || 'N/A'}</td>
                    </tr>`;
                });
                
                html += '</table>';
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `×©×’×™××”: ${error.message}`;
            }
        }

        async function searchHebrewParts() {
            results.innerHTML = '××—×¤×© ×—×œ×§×™× ×‘×¢×‘×¨×™×ª...';
            
            const hebrewTerms = ['×¤×’×•×©', '×›× ×£', '×¤× ×¡', '××¨××”', '×“×œ×ª', '×˜×•×™×•×˜×”', '×™×•×œ×™×§'];
            let foundResults = [];
            
            try {
                for (const term of hebrewTerms) {
                    console.log(`ğŸ” Testing Hebrew term: "${term}"`);
                    
                    // Test direct ILIKE search
                    const { data, error } = await window.supabase
                        .from('catalog_items')
                        .select('*')
                        .or(`cat_num_desc.ilike.%${term}%,part_family.ilike.%${term}%,make.ilike.%${term}%`)
                        .limit(5);
                    
                    if (!error && data && data.length > 0) {
                        foundResults.push({
                            term: term,
                            count: data.length,
                            samples: data.slice(0, 2)
                        });
                    }
                }
                
                let html = `<h3>×ª×•×¦××•×ª ×—×™×¤×•×© ×¢×‘×¨×™×ª:</h3>`;
                
                if (foundResults.length === 0) {
                    html += '<p>âŒ ×œ× × ××¦××• ×ª×•×¦××•×ª ×œ××£ ××™×œ×” ×‘×¢×‘×¨×™×ª</p>';
                    
                    // Try broader search
                    const { data: broadData } = await window.supabase
                        .from('catalog_items')
                        .select('cat_num_desc, part_family, make')
                        .not('cat_num_desc', 'is', null)
                        .limit(20);
                    
                    html += '<h4>×“×•×’×××•×ª ×ª×™××•×¨×™× ××”×××’×¨:</h4><ul>';
                    broadData?.forEach(item => {
                        if (item.cat_num_desc) {
                            html += `<li>${item.cat_num_desc}</li>`;
                        }
                    });
                    html += '</ul>';
                } else {
                    foundResults.forEach(result => {
                        html += `<h4>"${result.term}" - ${result.count} ×ª×•×¦××•×ª:</h4><ul>`;
                        result.samples.forEach(sample => {
                            html += `<li>${sample.cat_num_desc || sample.part_family || sample.make}</li>`;
                        });
                        html += '</ul>';
                    });
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `×©×’×™××”: ${error.message}`;
            }
        }

        async function searchEnglishParts() {
            results.innerHTML = '××—×¤×© ×—×œ×§×™× ×‘×× ×’×œ×™×ª...';
            
            const englishTerms = ['bumper', 'fender', 'door', 'toyota', 'light'];
            let foundResults = [];
            
            try {
                for (const term of englishTerms) {
                    const { data, error } = await window.supabase
                        .from('catalog_items')
                        .select('*')
                        .or(`cat_num_desc.ilike.%${term}%,part_family.ilike.%${term}%,make.ilike.%${term}%`)
                        .limit(5);
                    
                    if (!error && data && data.length > 0) {
                        foundResults.push({
                            term: term,
                            count: data.length,
                            samples: data.slice(0, 2)
                        });
                    }
                }
                
                let html = `<h3>×ª×•×¦××•×ª ×—×™×¤×•×© ×× ×’×œ×™×ª:</h3>`;
                
                if (foundResults.length === 0) {
                    html += '<p>âŒ ×œ× × ××¦××• ×ª×•×¦××•×ª ×œ××£ ××™×œ×” ×‘×× ×’×œ×™×ª</p>';
                } else {
                    foundResults.forEach(result => {
                        html += `<h4>"${result.term}" - ${result.count} ×ª×•×¦××•×ª:</h4><ul>`;
                        result.samples.forEach(sample => {
                            html += `<li>${sample.cat_num_desc || sample.part_family || sample.make}</li>`;
                        });
                        html += '</ul>';
                    });
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `×©×’×™××”: ${error.message}`;
            }
        }

        // Test PiP window function
        function testPiPWindow() {
            console.log('ğŸ§ª Testing PiP window visibility...');
            results.innerHTML = '×‘×•×“×§ ×—×œ×•×Ÿ PiP...';
            
            const sampleResults = [
                {
                    id: 'test-1',
                    pcode: 'TEST123',
                    cat_num_desc: 'Test Part Description - ×ª×™××•×¨ ×—×œ×§ ×œ×‘×“×™×§×”',
                    part_family: 'Test Family - ××©×¤×—×ª ×‘×“×™×§×”',
                    make: 'Toyota - ×˜×•×™×•×˜×”',
                    model: 'Corolla',
                    price: 150,
                    oem: 'TEST-OEM-123',
                    supplier_name: 'Test Supplier - ×¡×¤×§ ×‘×“×™×§×”',
                    availability: 'Available - ×–××™×Ÿ'
                },
                {
                    id: 'test-2',
                    pcode: 'TEST456',
                    cat_num_desc: 'Another Test Part - ×—×œ×§ × ×•×¡×£ ×œ×‘×“×™×§×”',
                    part_family: 'Another Family - ××©×¤×—×” ××—×¨×ª',
                    make: 'Honda - ×”×•× ×“×”',
                    model: 'Civic',
                    price: 200,
                    oem: 'TEST-OEM-456',
                    supplier_name: 'Another Supplier - ×¡×¤×§ ××—×¨',
                    availability: 'Available - ×–××™×Ÿ'
                }
            ];
            
            if (window.partsResultsPiP) {
                window.partsResultsPiP.showResults(sampleResults, {
                    plate: 'TEST-123-456',
                    sessionId: 'debug-test-session',
                    searchType: 'debug_test',
                    searchSuccess: true,
                    errorMessage: null,
                    searchTime: 100
                });
                results.innerHTML = '×—×œ×•×Ÿ PiP ×”×•×¤×¢×œ ×¢× × ×ª×•× ×™ ×‘×“×™×§×” - ×‘×“×•×§ ×× ×”×•× × ×¨××” ×¢×œ ×”××¡×š';
            } else {
                results.innerHTML = '×©×’×™××”: window.partsResultsPiP ×œ× ×–××™×Ÿ';
            }
        }
    </script>
</body>
</html>